<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CineBrain Support System API Tester</title>
    
    <!-- Bootstrap 5.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- Prism.js for code highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    
    <style>
        .api-section {
            margin-bottom: 2rem;
            border: 1px solid #e3e6f0;
            border-radius: 0.35rem;
            background: #fff;
        }
        
        .api-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            border-radius: 0.35rem 0.35rem 0 0;
            margin-bottom: 0;
        }
        
        .api-body {
            padding: 1.5rem;
        }
        
        .response-area {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1rem;
            margin-top: 1rem;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .method-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-weight: 600;
        }
        
        .method-get { background: #28a745; color: white; }
        .method-post { background: #007bff; color: white; }
        .method-put { background: #ffc107; color: black; }
        .method-delete { background: #dc3545; color: white; }
        
        .status-success { color: #28a745; }
        .status-error { color: #dc3545; }
        
        .navbar-brand {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }
        
        .form-label {
            font-weight: 600;
            color: #495057;
        }
        
        .btn-test {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            font-weight: 600;
        }
        
        .btn-test:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
            color: white;
        }
        
        .alert-api {
            border-left: 4px solid #667eea;
            background: #f8f9ff;
        }
        
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .file-upload-area {
            border: 2px dashed #dee2e6;
            border-radius: 0.375rem;
            padding: 2rem;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }
        
        .file-upload-area:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        
        .file-upload-area.drag-over {
            border-color: #667eea;
            background: #e3e6f0;
        }
        
        .loading {
            display: none;
        }
        
        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
        }
    </style>
</head>
<body class="bg-light">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="bi bi-headset me-2"></i>
                CineBrain Support API Tester
            </a>
            <div class="navbar-nav ms-auto">
                <div class="nav-item">
                    <span class="nav-link text-muted">
                        <i class="bi bi-server me-1"></i>
                        API Base: <code>https://cinebrain.onrender.com/api</code>
                    </span>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Global Settings -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="bi bi-gear me-2"></i>Global Settings</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label">Admin JWT Token (for admin endpoints)</label>
                                <input type="text" id="adminToken" class="form-control" placeholder="Bearer token for admin endpoints">
                                <small class="text-muted">Required for admin-only endpoints like stats and ticket management</small>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">API Response Format</label>
                                <select id="responseFormat" class="form-select">
                                    <option value="formatted">Formatted JSON</option>
                                    <option value="raw">Raw Response</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Support Health Check -->
        <div class="api-section">
            <div class="api-header">
                <h5 class="mb-0">
                    <i class="bi bi-heart-pulse me-2"></i>
                    Support Health Check
                    <span class="method-badge method-get ms-2">GET</span>
                </h5>
                <small>/api/support/health</small>
            </div>
            <div class="api-body">
                <div class="alert alert-api">
                    <i class="bi bi-info-circle me-2"></i>
                    Check the health status of the support system including services and database stats.
                </div>
                <button onclick="testSupportHealth()" class="btn btn-test">
                    <i class="bi bi-play-circle me-2"></i>Test Health Check
                    <span class="loading spinner-border spinner-border-sm ms-2"></span>
                </button>
                <div id="healthResponse" class="response-area"></div>
            </div>
        </div>

        <!-- Get Support Categories -->
        <div class="api-section">
            <div class="api-header">
                <h5 class="mb-0">
                    <i class="bi bi-tags me-2"></i>
                    Get Support Categories
                    <span class="method-badge method-get ms-2">GET</span>
                </h5>
                <small>/api/support/categories</small>
            </div>
            <div class="api-body">
                <div class="alert alert-api">
                    <i class="bi bi-info-circle me-2"></i>
                    Retrieve all available support categories for ticket creation.
                </div>
                <button onclick="testGetCategories()" class="btn btn-test">
                    <i class="bi bi-play-circle me-2"></i>Get Categories
                    <span class="loading spinner-border spinner-border-sm ms-2"></span>
                </button>
                <div id="categoriesResponse" class="response-area"></div>
            </div>
        </div>

        <!-- Create Support Ticket -->
        <div class="api-section">
            <div class="api-header">
                <h5 class="mb-0">
                    <i class="bi bi-ticket-perforated me-2"></i>
                    Create Support Ticket
                    <span class="method-badge method-post ms-2">POST</span>
                </h5>
                <small>/api/support/tickets</small>
            </div>
            <div class="api-body">
                <div class="alert alert-api">
                    <i class="bi bi-info-circle me-2"></i>
                    Create a new support ticket with priority and category assignment.
                </div>
                <form id="createTicketForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Name</label>
                                <input type="text" id="ticketName" class="form-control" value="John Doe" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Email</label>
                                <input type="email" id="ticketEmail" class="form-control" value="john@example.com" required>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Priority</label>
                                <select id="ticketPriority" class="form-select">
                                    <option value="low">Low</option>
                                    <option value="normal" selected>Normal</option>
                                    <option value="high">High</option>
                                    <option value="urgent">Urgent</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Category ID</label>
                                <input type="number" id="ticketCategory" class="form-control" value="1" min="1">
                                <small class="text-muted">Get categories first to see available IDs</small>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Subject</label>
                        <input type="text" id="ticketSubject" class="form-control" value="Test Support Ticket" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Message</label>
                        <textarea id="ticketMessage" class="form-control" rows="4" required>This is a test support ticket created through the API testing interface. Please ignore this message.</textarea>
                    </div>
                    <button type="button" onclick="testCreateTicket()" class="btn btn-test">
                        <i class="bi bi-plus-circle me-2"></i>Create Ticket
                        <span class="loading spinner-border spinner-border-sm ms-2"></span>
                    </button>
                </form>
                <div id="createTicketResponse" class="response-area"></div>
            </div>
        </div>

        <!-- Get Ticket Details -->
        <div class="api-section">
            <div class="api-header">
                <h5 class="mb-0">
                    <i class="bi bi-search me-2"></i>
                    Get Ticket Details
                    <span class="method-badge method-get ms-2">GET</span>
                </h5>
                <small>/api/support/tickets/{ticket_number}</small>
            </div>
            <div class="api-body">
                <div class="alert alert-api">
                    <i class="bi bi-info-circle me-2"></i>
                    Retrieve details for a specific ticket including activities and status.
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Ticket Number</label>
                            <input type="text" id="getTicketNumber" class="form-control" placeholder="CB-20241110-1234">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Email (for non-admin access)</label>
                            <input type="email" id="getTicketEmail" class="form-control" placeholder="user@example.com">
                        </div>
                    </div>
                </div>
                <button onclick="testGetTicket()" class="btn btn-test">
                    <i class="bi bi-search me-2"></i>Get Ticket
                    <span class="loading spinner-border spinner-border-sm ms-2"></span>
                </button>
                <div id="getTicketResponse" class="response-area"></div>
            </div>
        </div>

        <!-- Submit Contact Form -->
        <div class="api-section">
            <div class="api-header">
                <h5 class="mb-0">
                    <i class="bi bi-envelope me-2"></i>
                    Submit Contact Form
                    <span class="method-badge method-post ms-2">POST</span>
                </h5>
                <small>/api/support/contact</small>
            </div>
            <div class="api-body">
                <div class="alert alert-api">
                    <i class="bi bi-info-circle me-2"></i>
                    Submit a contact form message with automatic email notifications.
                </div>
                <form id="contactForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Name</label>
                                <input type="text" id="contactName" class="form-control" value="Jane Smith" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Email</label>
                                <input type="email" id="contactEmail" class="form-control" value="jane@example.com" required>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Phone (optional)</label>
                                <input type="tel" id="contactPhone" class="form-control" value="+1-555-123-4567">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Company (optional)</label>
                                <input type="text" id="contactCompany" class="form-control" value="Test Company Inc.">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Subject</label>
                        <input type="text" id="contactSubject" class="form-control" value="General Inquiry" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Message</label>
                        <textarea id="contactMessage" class="form-control" rows="4" required>Hello, this is a test contact form submission through the API testing interface. Please ignore this message. Thank you!</textarea>
                    </div>
                    <button type="button" onclick="testSubmitContact()" class="btn btn-test">
                        <i class="bi bi-send me-2"></i>Submit Contact
                        <span class="loading spinner-border spinner-border-sm ms-2"></span>
                    </button>
                </form>
                <div id="contactResponse" class="response-area"></div>
            </div>
        </div>

        <!-- Report Issue -->
        <div class="api-section">
            <div class="api-header">
                <h5 class="mb-0">
                    <i class="bi bi-bug me-2"></i>
                    Report Issue
                    <span class="method-badge method-post ms-2">POST</span>
                </h5>
                <small>/api/support/report-issue</small>
            </div>
            <div class="api-body">
                <div class="alert alert-api">
                    <i class="bi bi-info-circle me-2"></i>
                    Report a bug or issue with file upload capability for screenshots.
                </div>
                <form id="issueForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Name</label>
                                <input type="text" id="issueName" class="form-control" value="Alex Developer" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Email</label>
                                <input type="email" id="issueEmail" class="form-control" value="alex@example.com" required>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Issue Type</label>
                                <select id="issueType" class="form-select">
                                    <option value="bug_error">Bug/Error</option>
                                    <option value="feature_request">Feature Request</option>
                                    <option value="performance">Performance Issue</option>
                                    <option value="ui_ux">UI/UX Issue</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Severity</label>
                                <select id="issueSeverity" class="form-select">
                                    <option value="low">Low</option>
                                    <option value="normal" selected>Normal</option>
                                    <option value="high">High</option>
                                    <option value="critical">Critical</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Browser Version</label>
                                <input type="text" id="issueBrowser" class="form-control" value="Chrome 119.0.0.0">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Issue Title</label>
                        <input type="text" id="issueTitle" class="form-control" value="Test Bug Report" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea id="issueDescription" class="form-control" rows="4" required>This is a test bug report submitted through the API testing interface. The issue description would contain detailed information about the problem encountered.</textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Steps to Reproduce</label>
                                <textarea id="issueSteps" class="form-control" rows="3">1. Navigate to the test page
2. Click on the test button
3. Observe the error</textarea>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Expected Behavior</label>
                                <textarea id="issueExpected" class="form-control" rows="3">The application should work correctly without any errors.</textarea>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Screenshots (optional)</label>
                        <div class="file-upload-area" id="fileUploadArea">
                            <i class="bi bi-cloud-upload fs-1 text-muted mb-3 d-block"></i>
                            <p class="text-muted mb-2">Drag and drop files here or click to select</p>
                            <input type="file" id="issueFiles" class="d-none" multiple accept="image/*,.pdf">
                            <button type="button" class="btn btn-outline-primary" onclick="document.getElementById('issueFiles').click()">
                                <i class="bi bi-folder2-open me-2"></i>Select Files
                            </button>
                            <div id="filesList" class="mt-3"></div>
                        </div>
                    </div>
                    <button type="button" onclick="testReportIssue()" class="btn btn-test">
                        <i class="bi bi-bug me-2"></i>Report Issue
                        <span class="loading spinner-border spinner-border-sm ms-2"></span>
                    </button>
                </form>
                <div id="issueResponse" class="response-area"></div>
            </div>
        </div>

        <!-- Admin: Support Statistics -->
        <div class="api-section">
            <div class="api-header bg-warning">
                <h5 class="mb-0 text-dark">
                    <i class="bi bi-shield-lock me-2"></i>
                    Support Statistics (Admin Only)
                    <span class="method-badge method-get ms-2">GET</span>
                </h5>
                <small>/api/support/stats</small>
            </div>
            <div class="api-body">
                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    <strong>Admin Required:</strong> This endpoint requires admin authentication.
                </div>
                <button onclick="testSupportStats()" class="btn btn-warning">
                    <i class="bi bi-bar-chart me-2"></i>Get Support Stats
                    <span class="loading spinner-border spinner-border-sm ms-2"></span>
                </button>
                <div id="statsResponse" class="response-area"></div>
            </div>
        </div>

        <!-- Admin: List All Tickets -->
        <div class="api-section">
            <div class="api-header bg-warning">
                <h5 class="mb-0 text-dark">
                    <i class="bi bi-shield-lock me-2"></i>
                    List All Tickets (Admin Only)
                    <span class="method-badge method-get ms-2">GET</span>
                </h5>
                <small>/api/support/tickets</small>
            </div>
            <div class="api-body">
                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    <strong>Admin Required:</strong> This endpoint requires admin authentication.
                </div>
                <div class="row">
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label class="form-label">Status Filter</label>
                            <select id="listTicketsStatus" class="form-select">
                                <option value="">All Statuses</option>
                                <option value="open">Open</option>
                                <option value="in_progress">In Progress</option>
                                <option value="resolved">Resolved</option>
                                <option value="closed">Closed</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label class="form-label">Priority Filter</label>
                            <select id="listTicketsPriority" class="form-select">
                                <option value="">All Priorities</option>
                                <option value="urgent">Urgent</option>
                                <option value="high">High</option>
                                <option value="normal">Normal</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label class="form-label">Page</label>
                            <input type="number" id="listTicketsPage" class="form-control" value="1" min="1">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label class="form-label">Per Page</label>
                            <input type="number" id="listTicketsPerPage" class="form-control" value="25" min="1" max="100">
                        </div>
                    </div>
                </div>
                <button onclick="testListTickets()" class="btn btn-warning">
                    <i class="bi bi-list-ul me-2"></i>List Tickets
                    <span class="loading spinner-border spinner-border-sm ms-2"></span>
                </button>
                <div id="listTicketsResponse" class="response-area"></div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5.3 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Prism.js for code highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <script>
        const API_BASE = 'https://cinebrain.onrender.com/api';

        // Utility function to show loading state
        function showLoading(button) {
            button.disabled = true;
            button.querySelector('.loading').style.display = 'inline-block';
        }

        // Utility function to hide loading state
        function hideLoading(button) {
            button.disabled = false;
            button.querySelector('.loading').style.display = 'none';
        }

        // Utility function to display response
        function displayResponse(elementId, response, status, url, method) {
            const element = document.getElementById(elementId);
            const isSuccess = status >= 200 && status < 300;
            const statusClass = isSuccess ? 'status-success' : 'status-error';
            const format = document.getElementById('responseFormat').value;
            
            let formattedResponse;
            if (format === 'formatted' && typeof response === 'object') {
                formattedResponse = JSON.stringify(response, null, 2);
            } else {
                formattedResponse = typeof response === 'string' ? response : JSON.stringify(response);
            }

            element.innerHTML = `
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <strong class="${statusClass}">
                        <i class="bi bi-${isSuccess ? 'check-circle' : 'x-circle'} me-1"></i>
                        Status: ${status}
                    </strong>
                    <small class="text-muted">
                        ${method} ${url}
                    </small>
                </div>
                <pre><code class="language-json">${formattedResponse}</code></pre>
            `;
            
            // Re-run Prism highlighting
            Prism.highlightAllUnder(element);
        }

        // Utility function to make API requests
        async function makeRequest(url, method = 'GET', body = null, isFormData = false, requiresAuth = false) {
            const headers = {};
            
            if (!isFormData) {
                headers['Content-Type'] = 'application/json';
            }
            
            if (requiresAuth) {
                const token = document.getElementById('adminToken').value;
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }
            }

            const config = {
                method,
                headers
            };

            if (body) {
                config.body = isFormData ? body : JSON.stringify(body);
            }

            try {
                const response = await fetch(url, config);
                const data = await response.json();
                return { data, status: response.status, url, method };
            } catch (error) {
                return { 
                    data: { error: error.message }, 
                    status: 0, 
                    url, 
                    method 
                };
            }
        }

        // Test Support Health
        async function testSupportHealth() {
            const button = event.target.closest('button');
            showLoading(button);
            
            const result = await makeRequest(`${API_BASE}/support/health`);
            displayResponse('healthResponse', result.data, result.status, result.url, result.method);
            
            hideLoading(button);
        }

        // Test Get Categories
        async function testGetCategories() {
            const button = event.target.closest('button');
            showLoading(button);
            
            const result = await makeRequest(`${API_BASE}/support/categories`);
            displayResponse('categoriesResponse', result.data, result.status, result.url, result.method);
            
            hideLoading(button);
        }

        // Test Create Ticket
        async function testCreateTicket() {
            const button = event.target.closest('button');
            showLoading(button);
            
            const ticketData = {
                name: document.getElementById('ticketName').value,
                email: document.getElementById('ticketEmail').value,
                subject: document.getElementById('ticketSubject').value,
                message: document.getElementById('ticketMessage').value,
                priority: document.getElementById('ticketPriority').value,
                category_id: parseInt(document.getElementById('ticketCategory').value),
                ticket_type: 'general'
            };

            const result = await makeRequest(`${API_BASE}/support/tickets`, 'POST', ticketData);
            displayResponse('createTicketResponse', result.data, result.status, result.url, result.method);
            
            // If successful, populate the ticket number field
            if (result.status >= 200 && result.status < 300 && result.data.ticket_number) {
                document.getElementById('getTicketNumber').value = result.data.ticket_number;
                document.getElementById('getTicketEmail').value = ticketData.email;
            }
            
            hideLoading(button);
        }

        // Test Get Ticket
        async function testGetTicket() {
            const button = event.target.closest('button');
            showLoading(button);
            
            const ticketNumber = document.getElementById('getTicketNumber').value;
            const email = document.getElementById('getTicketEmail').value;
            
            if (!ticketNumber) {
                alert('Please enter a ticket number');
                hideLoading(button);
                return;
            }

            let url = `${API_BASE}/support/tickets/${ticketNumber}`;
            if (email) {
                url += `?email=${encodeURIComponent(email)}`;
            }

            const result = await makeRequest(url, 'GET', null, false, !email);
            displayResponse('getTicketResponse', result.data, result.status, result.url, result.method);
            
            hideLoading(button);
        }

        // Test Submit Contact
        async function testSubmitContact() {
            const button = event.target.closest('button');
            showLoading(button);
            
            const contactData = {
                name: document.getElementById('contactName').value,
                email: document.getElementById('contactEmail').value,
                phone: document.getElementById('contactPhone').value,
                company: document.getElementById('contactCompany').value,
                subject: document.getElementById('contactSubject').value,
                message: document.getElementById('contactMessage').value
            };

            const result = await makeRequest(`${API_BASE}/support/contact`, 'POST', contactData);
            displayResponse('contactResponse', result.data, result.status, result.url, result.method);
            
            hideLoading(button);
        }

        // Test Report Issue
        async function testReportIssue() {
            const button = event.target.closest('button');
            showLoading(button);
            
            const formData = new FormData();
            formData.append('name', document.getElementById('issueName').value);
            formData.append('email', document.getElementById('issueEmail').value);
            formData.append('issue_type', document.getElementById('issueType').value);
            formData.append('severity', document.getElementById('issueSeverity').value);
            formData.append('issue_title', document.getElementById('issueTitle').value);
            formData.append('description', document.getElementById('issueDescription').value);
            formData.append('browser_version', document.getElementById('issueBrowser').value);
            formData.append('steps_to_reproduce', document.getElementById('issueSteps').value);
            formData.append('expected_behavior', document.getElementById('issueExpected').value);
            formData.append('device_os', navigator.platform);
            formData.append('page_url', window.location.href);
            
            // Add files if any
            const files = document.getElementById('issueFiles').files;
            for (let i = 0; i < files.length; i++) {
                formData.append('screenshots', files[i]);
            }

            try {
                const response = await fetch(`${API_BASE}/support/report-issue`, {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                displayResponse('issueResponse', data, response.status, `${API_BASE}/support/report-issue`, 'POST');
            } catch (error) {
                displayResponse('issueResponse', { error: error.message }, 0, `${API_BASE}/support/report-issue`, 'POST');
            }
            
            hideLoading(button);
        }

        // Test Support Stats (Admin)
        async function testSupportStats() {
            const button = event.target.closest('button');
            showLoading(button);
            
            const result = await makeRequest(`${API_BASE}/support/stats`, 'GET', null, false, true);
            displayResponse('statsResponse', result.data, result.status, result.url, result.method);
            
            hideLoading(button);
        }

        // Test List Tickets (Admin)
        async function testListTickets() {
            const button = event.target.closest('button');
            showLoading(button);
            
            const params = new URLSearchParams();
            
            const status = document.getElementById('listTicketsStatus').value;
            if (status) params.append('status', status);
            
            const priority = document.getElementById('listTicketsPriority').value;
            if (priority) params.append('priority', priority);
            
            params.append('page', document.getElementById('listTicketsPage').value);
            params.append('per_page', document.getElementById('listTicketsPerPage').value);
            
            const url = `${API_BASE}/support/tickets?${params.toString()}`;
            const result = await makeRequest(url, 'GET', null, false, true);
            displayResponse('listTicketsResponse', result.data, result.status, result.url, result.method);
            
            hideLoading(button);
        }

        // File upload handling
        document.getElementById('issueFiles').addEventListener('change', function() {
            updateFilesList();
        });

        // Drag and drop handling
        const fileUploadArea = document.getElementById('fileUploadArea');
        
        fileUploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('drag-over');
        });
        
        fileUploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.classList.remove('drag-over');
        });
        
        fileUploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('drag-over');
            
            const files = e.dataTransfer.files;
            document.getElementById('issueFiles').files = files;
            updateFilesList();
        });
        
        fileUploadArea.addEventListener('click', function() {
            document.getElementById('issueFiles').click();
        });

        function updateFilesList() {
            const files = document.getElementById('issueFiles').files;
            const filesList = document.getElementById('filesList');
            
            if (files.length > 0) {
                let html = '<div class="mt-2"><strong>Selected files:</strong><ul class="list-unstyled mt-1">';
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    html += `<li class="text-muted"><i class="bi bi-file-earmark me-1"></i>${file.name} (${formatFileSize(file.size)})</li>`;
                }
                html += '</ul></div>';
                filesList.innerHTML = html;
            } else {
                filesList.innerHTML = '';
            }
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Auto-load categories on page load
        window.addEventListener('load', function() {
            // Small delay to let the page settle
            setTimeout(() => {
                testGetCategories();
            }, 500);
        });
    </script>
</body>
</html>