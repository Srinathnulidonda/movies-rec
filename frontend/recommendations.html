<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Recommendations</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 40px; }
        .header h1 { color: white; font-size: 2.5rem; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .header p { color: rgba(255,255,255,0.9); font-size: 1.1rem; }
        .nav-tabs { display: flex; justify-content: center; margin-bottom: 30px; background: rgba(255,255,255,0.1); border-radius: 15px; padding: 5px; backdrop-filter: blur(10px); }
        .nav-tab { background: none; border: none; padding: 12px 24px; margin: 0 5px; border-radius: 10px; color: white; cursor: pointer; transition: all 0.3s ease; font-size: 1rem; }
        .nav-tab.active { background: rgba(255,255,255,0.2); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .nav-tab:hover { background: rgba(255,255,255,0.15); }
        .section { display: none; }
        .section.active { display: block; }
        .loading { text-align: center; padding: 40px; color: white; font-size: 1.2rem; }
        .spinner { display: inline-block; width: 40px; height: 40px; border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: white; animation: spin 1s ease-in-out infinite; margin-right: 10px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .movies-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin-top: 20px; }
        .movie-card { background: rgba(255,255,255,0.95); border-radius: 15px; overflow: hidden; box-shadow: 0 8px 25px rgba(0,0,0,0.1); transition: all 0.3s ease; cursor: pointer; }
        .movie-card:hover { transform: translateY(-5px); box-shadow: 0 15px 40px rgba(0,0,0,0.2); }
        .movie-poster { width: 100%; height: 280px; object-fit: cover; }
        .movie-info { padding: 15px; }
        .movie-title { font-size: 1.1rem; font-weight: bold; margin-bottom: 8px; color: #333; line-height: 1.3; }
        .movie-rating { display: flex; align-items: center; margin-bottom: 8px; }
        .star { color: #ffd700; margin-right: 5px; }
        .rating-text { color: #666; font-size: 0.9rem; }
        .movie-year { color: #888; font-size: 0.9rem; margin-bottom: 10px; }
        .movie-overview { color: #666; font-size: 0.85rem; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
        .movie-actions { display: flex; gap: 10px; margin-top: 15px; }
        .btn { padding: 8px 16px; border: none; border-radius: 20px; cursor: pointer; font-size: 0.85rem; transition: all 0.3s ease; }
        .btn-primary { background: linear-gradient(45deg, #667eea, #764ba2); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
        .btn-secondary { background: rgba(0,0,0,0.1); color: #333; }
        .btn-secondary:hover { background: rgba(0,0,0,0.2); }
        .search-section { margin-bottom: 30px; }
        .search-container { display: flex; gap: 10px; max-width: 600px; margin: 0 auto; }
        .search-input { flex: 1; padding: 15px 20px; border: none; border-radius: 25px; background: rgba(255,255,255,0.9); font-size: 1rem; outline: none; }
        .search-input::placeholder { color: #999; }
        .search-btn { padding: 15px 30px; background: rgba(255,255,255,0.2); border: none; border-radius: 25px; color: white; cursor: pointer; transition: all 0.3s ease; }
        .search-btn:hover { background: rgba(255,255,255,0.3); }
        .filters { display: flex; gap: 15px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
        .filter-btn { padding: 8px 16px; background: rgba(255,255,255,0.1); border: none; border-radius: 20px; color: white; cursor: pointer; transition: all 0.3s ease; }
        .filter-btn.active { background: rgba(255,255,255,0.3); }
        .filter-btn:hover { background: rgba(255,255,255,0.2); }
        .empty-state { text-align: center; padding: 60px 20px; color: white; }
        .empty-state h3 { font-size: 1.5rem; margin-bottom: 10px; }
        .empty-state p { opacity: 0.8; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); }
        .modal-content { background: white; margin: 2% auto; padding: 0; width: 90%; max-width: 800px; border-radius: 15px; position: relative; max-height: 90vh; overflow-y: auto; }
        .modal-header { position: relative; height: 400px; background-size: cover; background-position: center; border-radius: 15px 15px 0 0; }
        .modal-header::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(0,0,0,0.8)); border-radius: 15px 15px 0 0; }
        .close { position: absolute; top: 15px; right: 20px; color: white; font-size: 28px; font-weight: bold; cursor: pointer; z-index: 10; }
        .close:hover { opacity: 0.7; }
        .modal-info { position: absolute; bottom: 20px; left: 20px; right: 20px; color: white; z-index: 5; }
        .modal-title { font-size: 2rem; margin-bottom: 10px; }
        .modal-meta { display: flex; gap: 20px; margin-bottom: 15px; }
        .modal-body { padding: 30px; }
        .modal-overview { line-height: 1.6; margin-bottom: 20px; color: #555; }
        .modal-actions { display: flex; gap: 15px; }
        .notification { position: fixed; top: 20px; right: 20px; padding: 15px 25px; background: #4CAF50; color: white; border-radius: 5px; z-index: 1001; transform: translateX(400px); transition: transform 0.3s ease; }
        .notification.show { transform: translateX(0); }
        .notification.error { background: #f44336; }
        @media (max-width: 768px) { .movies-grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; } .movie-card { border-radius: 10px; } .movie-poster { height: 220px; } .movie-info { padding: 12px; } .nav-tabs { flex-wrap: wrap; } .nav-tab { padding: 10px 16px; margin: 2px; } .search-container { flex-direction: column; } .filters { justify-content: center; } .modal-content { width: 95%; margin: 5% auto; } .modal-header { height: 250px; } .modal-title { font-size: 1.5rem; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé¨ Movie Recommendations</h1>
            <p>Discover your next favorite movie</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('recommendations')">For You</button>
            <button class="nav-tab" onclick="showSection('trending')">Trending</button>
            <button class="nav-tab" onclick="showSection('search')">Search</button>
            <button class="nav-tab" onclick="showSection('favorites')">Favorites</button>
            <button class="nav-tab" onclick="showSection('wishlist')">Wishlist</button>
        </div>

        <!-- Recommendations Section -->
        <div id="recommendations" class="section active">
            <div class="loading" id="rec-loading">
                <div class="spinner"></div>
                Loading personalized recommendations...
            </div>
            <div class="movies-grid" id="rec-movies"></div>
        </div>

        <!-- Trending Section -->
        <div id="trending" class="section">
            <div class="filters">
                <button class="filter-btn active" onclick="loadTrending('all')">All</button>
                <button class="filter-btn" onclick="loadTrending('movie')">Movies</button>
                <button class="filter-btn" onclick="loadTrending('tv')">TV Shows</button>
            </div>
            <div class="loading" id="trending-loading" style="display: none;">
                <div class="spinner"></div>
                Loading trending content...
            </div>
            <div class="movies-grid" id="trending-movies"></div>
        </div>

        <!-- Search Section -->
        <div id="search" class="section">
            <div class="search-section">
                <div class="search-container">
                    <input type="text" class="search-input" id="search-input" placeholder="Search for movies and TV shows...">
                    <button class="search-btn" onclick="searchMovies()">üîç Search</button>
                </div>
            </div>
            <div class="loading" id="search-loading" style="display: none;">
                <div class="spinner"></div>
                Searching...
            </div>
            <div class="movies-grid" id="search-results"></div>
        </div>

        <!-- Favorites Section -->
        <div id="favorites" class="section">
            <div class="loading" id="fav-loading" style="display: none;">
                <div class="spinner"></div>
                Loading favorites...
            </div>
            <div class="movies-grid" id="fav-movies"></div>
            <div class="empty-state" id="fav-empty" style="display: none;">
                <h3>No favorites yet</h3>
                <p>Start adding movies to your favorites to see them here!</p>
            </div>
        </div>

        <!-- Wishlist Section -->
        <div id="wishlist" class="section">
            <div class="loading" id="wish-loading" style="display: none;">
                <div class="spinner"></div>
                Loading wishlist...
            </div>
            <div class="movies-grid" id="wish-movies"></div>
            <div class="empty-state" id="wish-empty" style="display: none;">
                <h3>Your wishlist is empty</h3>
                <p>Add movies to your wishlist to watch them later!</p>
            </div>
        </div>
    </div>

    <!-- Movie Detail Modal -->
    <div id="movieModal" class="modal">
        <div class="modal-content">
            <div class="modal-header" id="modal-backdrop">
                <span class="close" onclick="closeModal()">&times;</span>
                <div class="modal-info">
                    <h2 class="modal-title" id="modal-title"></h2>
                    <div class="modal-meta">
                        <span id="modal-year"></span>
                        <span id="modal-rating"></span>
                        <span id="modal-runtime"></span>
                    </div>
                </div>
            </div>
            <div class="modal-body">
                <p class="modal-overview" id="modal-overview"></p>
                <div class="modal-actions">
                    <button class="btn btn-primary" onclick="addToWishlist()">Add to Wishlist</button>
                    <button class="btn btn-primary" onclick="addToFavorites()">Add to Favorites</button>
                    <button class="btn btn-secondary" onclick="markAsWatched()">Mark as Watched</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <script>
        const API_BASE = 'https://movies-rec-1hcv.onrender.com/api';
        let currentMovie = null;
        let currentSection = 'recommendations';
        let authToken = localStorage.getItem('authToken');

        // Show notification
        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${isError ? 'error' : ''} show`;
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // API call helper
        async function apiCall(endpoint, options = {}) {
            const headers = { 'Content-Type': 'application/json' };
            if (authToken) headers['Authorization'] = `Bearer ${authToken}`;
            
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    headers,
                    ...options
                });
                
                if (response.status === 401) {
                    showNotification('Please log in to continue', true);
                    return null;
                }
                
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                showNotification('Connection error', true);
                return null;
            }
        }

        // Show section
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            
            document.getElementById(sectionName).classList.add('active');
            event.target.classList.add('active');
            
            currentSection = sectionName;
            
            switch(sectionName) {
                case 'recommendations':
                    loadRecommendations();
                    break;
                case 'trending':
                    loadTrending();
                    break;
                case 'favorites':
                    loadFavorites();
                    break;
                case 'wishlist':
                    loadWishlist();
                    break;
            }
        }

        // Load recommendations
        async function loadRecommendations() {
            const loading = document.getElementById('rec-loading');
            const container = document.getElementById('rec-movies');
            
            loading.style.display = 'block';
            container.innerHTML = '';
            
            const data = await apiCall('/recommendations');
            loading.style.display = 'none';
            
            if (data && data.results) {
                renderMovies(data.results, container);
            } else {
                container.innerHTML = '<div class="empty-state"><h3>Unable to load recommendations</h3><p>Please try again later</p></div>';
            }
        }

        // Load trending
        async function loadTrending(type = 'all') {
            const loading = document.getElementById('trending-loading');
            const container = document.getElementById('trending-movies');
            
            // Update filter buttons
            document.querySelectorAll('#trending .filter-btn').forEach(btn => btn.classList.remove('active'));
            event?.target?.classList.add('active');
            
            loading.style.display = 'block';
            container.innerHTML = '';
            
            const data = await apiCall('/trending');
            loading.style.display = 'none';
            
            if (data && data.results) {
                let results = data.results;
                if (type !== 'all') {
                    results = results.filter(movie => movie.media_type === type);
                }
                renderMovies(results, container);
            }
        }

        // Search movies
        async function searchMovies() {
            const query = document.getElementById('search-input').value.trim();
            if (!query) return;
            
            const loading = document.getElementById('search-loading');
            const container = document.getElementById('search-results');
            
            loading.style.display = 'block';
            container.innerHTML = '';
            
            const data = await apiCall(`/search?q=${encodeURIComponent(query)}`);
            loading.style.display = 'none';
            
            if (data && data.results) {
                renderMovies(data.results, container);
            }
        }

        // Load favorites
        async function loadFavorites() {
            const loading = document.getElementById('fav-loading');
            const container = document.getElementById('fav-movies');
            const empty = document.getElementById('fav-empty');
            
            loading.style.display = 'block';
            container.innerHTML = '';
            empty.style.display = 'none';
            
            const data = await apiCall('/favorites');
            loading.style.display = 'none';
            
            if (data && data.length > 0) {
                renderMovies(data.map(item => ({
                    id: item.movie_id,
                    title: item.title,
                    poster_path: item.poster_path,
                    vote_average: 0,
                    release_date: '',
                    overview: ''
                })), container);
            } else {
                empty.style.display = 'block';
            }
        }

        // Load wishlist
        async function loadWishlist() {
            const loading = document.getElementById('wish-loading');
            const container = document.getElementById('wish-movies');
            const empty = document.getElementById('wish-empty');
            
            loading.style.display = 'block';
            container.innerHTML = '';
            empty.style.display = 'none';
            
            const data = await apiCall('/wishlist');
            loading.style.display = 'none';
            
            if (data && data.length > 0) {
                renderMovies(data.map(item => ({
                    id: item.movie_id,
                    title: item.title,
                    poster_path: item.poster_path,
                    vote_average: 0,
                    release_date: '',
                    overview: ''
                })), container);
            } else {
                empty.style.display = 'block';
            }
        }

        // Render movies
        function renderMovies(movies, container) {
            container.innerHTML = movies.map(movie => `
                <div class="movie-card" onclick="openMovieModal(${movie.id})">
                    <img src="https://image.tmdb.org/t/p/w300${movie.poster_path}" 
                         alt="${movie.title}" 
                         class="movie-poster"
                         onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjQ1MCIgdmlld0JveD0iMCAwIDMwMCA0NTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iNDUwIiBmaWxsPSIjRjNGNEY2Ii8+CjxyZWN0IHg9IjEwMCIgeT0iMTUwIiB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI0Q1RDlERCIvPgo8L3N2Zz4='">
                    <div class="movie-info">
                        <div class="movie-title">${movie.title}</div>
                        <div class="movie-rating">
                            <span class="star">‚≠ê</span>
                            <span class="rating-text">${movie.vote_average?.toFixed(1) || '0.0'}</span>
                        </div>
                        <div class="movie-year">${movie.release_date?.split('-')[0] || 'N/A'}</div>
                        <div class="movie-overview">${movie.overview || 'No description available'}</div>
                    </div>
                </div>
            `).join('');
        }

        // Open movie modal
        async function openMovieModal(movieId) {
            const data = await apiCall(`/details/${movieId}`);
            if (!data) return;
            
            currentMovie = data;
            
            document.getElementById('modal-title').textContent = data.title;
            document.getElementById('modal-year').textContent = data.release_date?.split('-')[0] || 'N/A';
            document.getElementById('modal-rating').textContent = `‚≠ê ${data.vote_average?.toFixed(1) || '0.0'}`;
            document.getElementById('modal-runtime').textContent = `${data.runtime || 0} min`;
            document.getElementById('modal-overview').textContent = data.overview || 'No description available';
            
            const backdrop = document.getElementById('modal-backdrop');
            if (data.backdrop_path) {
                backdrop.style.backgroundImage = `url(https://image.tmdb.org/t/p/w1280${data.backdrop_path})`;
            }
            
            document.getElementById('movieModal').style.display = 'block';
        }

        // Close modal
        function closeModal() {
            document.getElementById('movieModal').style.display = 'none';
            currentMovie = null;
        }

        // Add to wishlist
        async function addToWishlist() {
            if (!currentMovie) return;
            
            const result = await apiCall('/wishlist', {
                method: 'POST',
                body: JSON.stringify({
                    movie_id: currentMovie.id,
                    title: currentMovie.title,
                    poster_path: currentMovie.poster_path
                })
            });
            
            if (result) {
                showNotification('Added to wishlist!');
            }
        }

        // Add to favorites
        async function addToFavorites() {
            if (!currentMovie) return;
            
            const result = await apiCall('/favorites', {
                method: 'POST',
                body: JSON.stringify({
                    movie_id: currentMovie.id,
                    title: currentMovie.title,
                    poster_path: currentMovie.poster_path
                })
            });
            
            if (result) {
                showNotification('Added to favorites!');
            }
        }

        // Mark as watched
        async function markAsWatched() {
            if (!currentMovie) return;
            
            const result = await apiCall('/watch-history', {
                method: 'POST',
                body: JSON.stringify({
                    movie_id: currentMovie.id,
                    title: currentMovie.title,
                    poster_path: currentMovie.poster_path
                })
            });
            
            if (result) {
                showNotification('Added to watch history!');
            }
        }

        // Search on Enter key
        document.getElementById('search-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchMovies();
            }
        });

        // Close modal on outside click
        window.onclick = function(event) {
            const modal = document.getElementById('movieModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadRecommendations();
        });
    </script>
</body>
</html>