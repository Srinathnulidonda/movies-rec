<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CineBrain Admin Dashboard - Testing Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: #1a73e8;
            color: white;
            padding: 15px 0;
            margin-bottom: 20px;
            border-radius: 8px;
        }

        .header h1 {
            text-align: center;
            font-size: 24px;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 8px;
            margin-bottom: 20px;
            overflow-x: auto;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .nav-tab {
            padding: 15px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            transition: all 0.3s;
        }

        .nav-tab:hover {
            background: #f8f9fa;
        }

        .nav-tab.active {
            border-bottom-color: #1a73e8;
            color: #1a73e8;
            font-weight: 600;
        }

        /* Auth Section */
        .auth-section {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            margin: 50px auto;
        }

        /* Content Sections */
        .content-section {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .content-section.active {
            display: block;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-control:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: #1a73e8;
            color: white;
        }

        .btn-primary:hover {
            background: #1557b0;
        }

        .btn-success {
            background: #34a853;
            color: white;
        }

        .btn-success:hover {
            background: #2d8f47;
        }

        .btn-warning {
            background: #fbbc04;
            color: #333;
        }

        .btn-warning:hover {
            background: #f9ab00;
        }

        .btn-danger {
            background: #ea4335;
            color: white;
        }

        .btn-danger:hover {
            background: #d93025;
        }

        .btn-secondary {
            background: #5f6368;
            color: white;
        }

        .btn-secondary:hover {
            background: #4a4d52;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .card-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            font-weight: 600;
            background: #f8f9fa;
            border-radius: 8px 8px 0 0;
        }

        .card-body {
            padding: 20px;
        }

        /* Grid */
        .row {
            display: flex;
            flex-wrap: wrap;
            margin: -10px;
        }

        .col-1 {
            flex: 0 0 8.333%;
        }

        .col-2 {
            flex: 0 0 16.666%;
        }

        .col-3 {
            flex: 0 0 25%;
        }

        .col-4 {
            flex: 0 0 33.333%;
        }

        .col-6 {
            flex: 0 0 50%;
        }

        .col-8 {
            flex: 0 0 66.666%;
        }

        .col-12 {
            flex: 0 0 100%;
        }

        .col-1,
        .col-2,
        .col-3,
        .col-4,
        .col-6,
        .col-8,
        .col-12 {
            padding: 10px;
        }

        /* Tables */
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .table th {
            background: #f8f9fa;
            font-weight: 600;
        }

        .table tbody tr:hover {
            background: #f8f9fa;
        }

        /* Status Badges */
        .badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-success {
            background: #e8f5e8;
            color: #2d8f47;
        }

        .badge-warning {
            background: #fff8e1;
            color: #f57c00;
        }

        .badge-danger {
            background: #fce8e6;
            color: #d93025;
        }

        .badge-info {
            background: #e3f2fd;
            color: #1976d2;
        }

        .badge-secondary {
            background: #f5f5f5;
            color: #5f6368;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid #eee;
            text-align: right;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        /* Alerts */
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            border: 1px solid transparent;
        }

        .alert-success {
            color: #155724;
            background-color: #d4edda;
            border-color: #c3e6cb;
        }

        .alert-error {
            color: #721c24;
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }

        .alert-info {
            color: #0c5460;
            background-color: #d1ecf1;
            border-color: #bee5eb;
        }

        /* Metrics Cards */
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .metric-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 14px;
            opacity: 0.9;
        }

        /* Notifications Panel */
        .notifications-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 350px;
            max-height: 400px;
            overflow-y: auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            display: none;
        }

        .notification-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }

        .notification-item:hover {
            background: #f8f9fa;
        }

        .notification-item.unread {
            background: #e3f2fd;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .notification-message {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .notification-time {
            font-size: 12px;
            color: #999;
        }

        /* Search and Filters */
        .search-filters {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .search-filters .row {
            align-items: flex-end;
        }

        /* Loading Spinner */
        .loading {
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #1a73e8;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .row {
                flex-direction: column;
            }

            .col-1,
            .col-2,
            .col-3,
            .col-4,
            .col-6,
            .col-8,
            .col-12 {
                flex: 0 0 100%;
            }

            .notifications-panel {
                position: relative;
                top: auto;
                right: auto;
                width: 100%;
                margin-bottom: 20px;
                display: block;
            }
        }

        /* Status indicators */
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }

        .status-healthy {
            background: #34a853;
        }

        .status-warning {
            background: #fbbc04;
        }

        .status-error {
            background: #ea4335;
        }

        .status-offline {
            background: #9aa0a6;
        }

        /* Code blocks */
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 10px 0;
        }

        /* Progress bars */
        .progress {
            width: 100%;
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: #1a73e8;
            transition: width 0.3s;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üé¨ CineBrain Admin Dashboard - Testing Interface</h1>
        </div>

        <!-- Authentication Section -->
        <div id="authSection" class="auth-section">
            <h2 style="text-align: center; margin-bottom: 20px;">Admin Login</h2>
            <div class="form-group">
                <label for="loginEmail">Email</label>
                <input type="email" id="loginEmail" class="form-control" value="srinathnani09@gmail.com"
                    placeholder="Enter admin email">
            </div>
            <div class="form-group">
                <label for="loginPassword">Password</label>
                <input type="password" id="loginPassword" class="form-control" value="admin123"
                    placeholder="Enter password">
            </div>
            <button onclick="adminLogin()" class="btn btn-primary" style="width: 100%;">Login</button>

            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 4px;">
                <h4>Test Credentials:</h4>
                <p><strong>Email:</strong> srinathnani09@gmail.com</p>
                <p><strong>Password:</strong> admin123</p>
                <p><small>These are the default admin credentials from your app.py</small></p>
            </div>

            <div style="margin-top: 20px; padding: 15px; background: #e3f2fd; border-radius: 4px;">
                <h4>API Base URL:</h4>
                <input type="text" id="apiBaseUrl" class="form-control" value="http://localhost:5000"
                    placeholder="Enter API base URL">
                <small>Update this to match your backend server URL</small>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div id="navTabs" class="nav-tabs" style="display: none;">
            <div class="nav-tab active" onclick="showSection('dashboard')">üìä Dashboard</div>
            <div class="nav-tab" onclick="showSection('support')">üéß Support</div>
            <div class="nav-tab" onclick="showSection('content')">üé¨ Content</div>
            <div class="nav-tab" onclick="showSection('users')">üë• Users</div>
            <div class="nav-tab" onclick="showSection('analytics')">üìà Analytics</div>
            <div class="nav-tab" onclick="showSection('system')">‚öôÔ∏è System</div>
            <div class="nav-tab" onclick="showSection('notifications')">üîî Notifications</div>
            <div class="nav-tab" onclick="logout()">üö™ Logout</div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboardSection" class="content-section active">
            <div class="card">
                <div class="card-header">üìä Admin Dashboard Overview</div>
                <div class="card-body">
                    <div class="row" id="dashboardMetrics">
                        <div class="col-3">
                            <div class="metric-card">
                                <div class="metric-number" id="totalUsers">-</div>
                                <div class="metric-label">Total Users</div>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="metric-card">
                                <div class="metric-number" id="totalContent">-</div>
                                <div class="metric-label">Total Content</div>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="metric-card">
                                <div class="metric-number" id="totalInteractions">-</div>
                                <div class="metric-label">Total Interactions</div>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="metric-card">
                                <div class="metric-number" id="activeUsers">-</div>
                                <div class="metric-label">Active Users</div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-6">
                            <h4>Support Metrics</h4>
                            <div id="supportMetrics">
                                <div class="loading">
                                    <div class="spinner"></div>
                                    <p>Loading support metrics...</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <h4>System Health</h4>
                            <div id="systemHealth">
                                <div class="loading">
                                    <div class="spinner"></div>
                                    <p>Checking system health...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button onclick="loadDashboard()" class="btn btn-primary">üîÑ Refresh Dashboard</button>
                </div>
            </div>
        </div>

        <!-- Support Section -->
        <div id="supportSection" class="content-section">
            <div class="card">
                <div class="card-header">üéß Support Management</div>
                <div class="card-body">
                    <!-- Support Dashboard -->
                    <div class="row">
                        <div class="col-12">
                            <h4>Support Dashboard</h4>
                            <button onclick="loadSupportDashboard()" class="btn btn-primary">üìä Load Support
                                Dashboard</button>
                            <div id="supportDashboardData"></div>
                        </div>
                    </div>

                    <!-- Tickets Management -->
                    <div class="row" style="margin-top: 30px;">
                        <div class="col-12">
                            <h4>Support Tickets</h4>

                            <!-- Filters -->
                            <div class="search-filters">
                                <div class="row">
                                    <div class="col-3">
                                        <label>Status</label>
                                        <select id="ticketStatus" class="form-control">
                                            <option value="">All Statuses</option>
                                            <option value="open">Open</option>
                                            <option value="in_progress">In Progress</option>
                                            <option value="resolved">Resolved</option>
                                            <option value="closed">Closed</option>
                                        </select>
                                    </div>
                                    <div class="col-3">
                                        <label>Priority</label>
                                        <select id="ticketPriority" class="form-control">
                                            <option value="">All Priorities</option>
                                            <option value="low">Low</option>
                                            <option value="normal">Normal</option>
                                            <option value="high">High</option>
                                            <option value="urgent">Urgent</option>
                                        </select>
                                    </div>
                                    <div class="col-3">
                                        <label>Search</label>
                                        <input type="text" id="ticketSearch" class="form-control"
                                            placeholder="Search tickets...">
                                    </div>
                                    <div class="col-3">
                                        <label>&nbsp;</label><br>
                                        <button onclick="loadSupportTickets()" class="btn btn-primary">üîç Search
                                            Tickets</button>
                                    </div>
                                </div>
                            </div>

                            <div id="supportTicketsData"></div>
                        </div>
                    </div>

                    <!-- FAQ Management -->
                    <div class="row" style="margin-top: 30px;">
                        <div class="col-12">
                            <h4>FAQ Management</h4>
                            <button onclick="loadFAQs()" class="btn btn-primary">üìã Load FAQs</button>
                            <button onclick="showCreateFAQModal()" class="btn btn-success">‚ûï Create FAQ</button>
                            <div id="faqData"></div>
                        </div>
                    </div>

                    <!-- Feedback Management -->
                    <div class="row" style="margin-top: 30px;">
                        <div class="col-12">
                            <h4>Feedback Management</h4>
                            <button onclick="loadFeedback()" class="btn btn-primary">üí¨ Load Feedback</button>
                            <div id="feedbackData"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content Section -->
        <div id="contentSection" class="content-section">
            <div class="card">
                <div class="card-header">üé¨ Content Management</div>
                <div class="card-body">
                    <!-- External Content Search -->
                    <div class="row">
                        <div class="col-12">
                            <h4>Search External Content</h4>
                            <div class="row">
                                <div class="col-4">
                                    <input type="text" id="contentSearchQuery" class="form-control"
                                        placeholder="Search movies, TV shows, anime...">
                                </div>
                                <div class="col-3">
                                    <select id="contentSearchSource" class="form-control">
                                        <option value="tmdb">TMDB (Movies/TV)</option>
                                        <option value="anime">Anime</option>
                                    </select>
                                </div>
                                <div class="col-3">
                                    <button onclick="searchExternalContent()" class="btn btn-primary">üîç Search</button>
                                </div>
                            </div>
                            <div id="externalContentResults"></div>
                        </div>
                    </div>

                    <!-- Admin Recommendations -->
                    <div class="row" style="margin-top: 30px;">
                        <div class="col-12">
                            <h4>Create Admin Recommendation</h4>
                            <div class="row">
                                <div class="col-4">
                                    <input type="number" id="recContentId" class="form-control"
                                        placeholder="Content ID">
                                </div>
                                <div class="col-3">
                                    <select id="recType" class="form-control">
                                        <option value="admin_choice">Admin Choice</option>
                                        <option value="editors_pick">Editor's Pick</option>
                                        <option value="trending">Trending</option>
                                        <option value="must_watch">Must Watch</option>
                                    </select>
                                </div>
                                <div class="col-5">
                                    <input type="text" id="recDescription" class="form-control"
                                        placeholder="Recommendation description">
                                </div>
                            </div>
                            <button onclick="createAdminRecommendation()" class="btn btn-success"
                                style="margin-top: 10px;">‚ú® Create Recommendation</button>
                        </div>
                    </div>

                    <!-- Content Management -->
                    <div class="row" style="margin-top: 30px;">
                        <div class="col-12">
                            <h4>Manage Existing Content</h4>
                            <button onclick="loadContentManagement()" class="btn btn-primary">üìë Load Content</button>
                            <div id="contentManagementData"></div>
                        </div>
                    </div>

                    <!-- Admin Recommendations List -->
                    <div class="row" style="margin-top: 30px;">
                        <div class="col-12">
                            <h4>Admin Recommendations</h4>
                            <button onclick="loadAdminRecommendations()" class="btn btn-primary">‚≠ê Load
                                Recommendations</button>
                            <div id="adminRecommendationsData"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Users Section -->
        <div id="usersSection" class="content-section">
            <div class="card">
                <div class="card-header">üë• User Management</div>
                <div class="card-body">
                    <div class="search-filters">
                        <div class="row">
                            <div class="col-4">
                                <input type="text" id="userSearch" class="form-control" placeholder="Search users...">
                            </div>
                            <div class="col-2">
                                <button onclick="loadUsers()" class="btn btn-primary">üîç Search Users</button>
                            </div>
                        </div>
                    </div>
                    <div id="usersData"></div>
                </div>
            </div>
        </div>

        <!-- Analytics Section -->
        <div id="analyticsSection" class="content-section">
            <div class="card">
                <div class="card-header">üìà Analytics & Reports</div>
                <div class="card-body">
                    <button onclick="loadAnalytics()" class="btn btn-primary">üìä Load Analytics</button>
                    <div id="analyticsData"></div>
                </div>
            </div>
        </div>

        <!-- System Section -->
        <div id="systemSection" class="content-section">
            <div class="card">
                <div class="card-header">‚öôÔ∏è System Management</div>
                <div class="card-body">
                    <!-- Cache Management -->
                    <div class="row">
                        <div class="col-6">
                            <h4>Cache Management</h4>
                            <button onclick="clearCache('all')" class="btn btn-warning">üóëÔ∏è Clear All Cache</button>
                            <button onclick="clearCache('search')" class="btn btn-warning">üîç Clear Search
                                Cache</button>
                            <button onclick="clearCache('recommendations')" class="btn btn-warning">‚≠ê Clear
                                Recommendations Cache</button>
                            <button onclick="clearCache('support')" class="btn btn-warning">üéß Clear Support
                                Cache</button>
                            <button onclick="loadCacheStats()" class="btn btn-primary">üìä Cache Statistics</button>
                        </div>
                        <div class="col-6">
                            <h4>System Health</h4>
                            <button onclick="loadSystemHealth()" class="btn btn-primary">üè• Check System Health</button>
                        </div>
                    </div>

                    <div class="row" style="margin-top: 20px;">
                        <div class="col-12">
                            <div id="systemData"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notifications Section -->
        <div id="notificationsSection" class="content-section">
            <div class="card">
                <div class="card-header">üîî Real-time Notifications</div>
                <div class="card-body">
                    <button onclick="loadNotifications()" class="btn btn-primary">üîî Load Notifications</button>
                    <button onclick="sendTestNotification()" class="btn btn-success">üì§ Send Test Notification</button>
                    <div id="notificationsData"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications Panel -->
    <div id="notificationsPanel" class="notifications-panel">
        <div class="card-header">
            <strong>Live Notifications</strong>
            <span onclick="toggleNotificationsPanel()" class="close">&times;</span>
        </div>
        <div id="liveNotifications"></div>
    </div>

    <!-- Modal for Ticket Details -->
    <div id="ticketModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="ticketModalTitle">Ticket Details</h3>
                <span class="close" onclick="closeModal('ticketModal')">&times;</span>
            </div>
            <div class="modal-body" id="ticketModalBody">
                <!-- Ticket details will be loaded here -->
            </div>
            <div class="modal-footer">
                <button onclick="closeModal('ticketModal')" class="btn btn-secondary">Close</button>
            </div>
        </div>
    </div>

    <!-- Modal for FAQ Creation -->
    <div id="faqModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="faqModalTitle">Create FAQ</h3>
                <span class="close" onclick="closeModal('faqModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Question</label>
                    <input type="text" id="faqQuestion" class="form-control" placeholder="Enter FAQ question">
                </div>
                <div class="form-group">
                    <label>Answer</label>
                    <textarea id="faqAnswer" class="form-control" rows="5" placeholder="Enter FAQ answer"></textarea>
                </div>
                <div class="form-group">
                    <label>Category ID</label>
                    <input type="number" id="faqCategoryId" class="form-control" placeholder="Enter category ID"
                        value="1">
                </div>
                <div class="form-group">
                    <label>Tags (comma-separated)</label>
                    <input type="text" id="faqTags" class="form-control" placeholder="e.g., account, login, password">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="faqFeatured"> Featured FAQ
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="faqPublished" checked> Published
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="createFAQ()" class="btn btn-success">Create FAQ</button>
                <button onclick="closeModal('faqModal')" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Alert Container -->
    <div id="alertContainer"
        style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 1001; width: 400px;"></div>

    <script>
        // Global variables
        let authToken = '';
        let apiBaseUrl = 'http://127.0.0.1:5000';
        let currentUser = null;

        // Utility functions
        function showAlert(message, type = 'info') {
            const alertContainer = document.getElementById('alertContainer');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = `
                ${message}
                <button onclick="this.parentElement.remove()" style="float: right; background: none; border: none; font-size: 16px; cursor: pointer;">&times;</button>
            `;
            alertContainer.appendChild(alertDiv);

            setTimeout(() => {
                if (alertDiv.parentElement) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        function getApiHeaders() {
            return {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`
            };
        }

        async function apiCall(endpoint, method = 'GET', data = null) {
            try {
                const url = `${apiBaseUrl}${endpoint}`;
                const options = {
                    method,
                    headers: getApiHeaders()
                };

                if (data) {
                    options.body = JSON.stringify(data);
                }

                const response = await fetch(url, options);
                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.error || `HTTP ${response.status}`);
                }

                return result;
            } catch (error) {
                console.error('API call failed:', error);
                showAlert(`API Error: ${error.message}`, 'error');
                throw error;
            }
        }

        // Authentication
        async function adminLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            apiBaseUrl = document.getElementById('apiBaseUrl').value;

            if (!email || !password) {
                showAlert('Please enter email and password', 'error');
                return;
            }

            try {
                const response = await fetch(`${apiBaseUrl}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const result = await response.json();

                if (response.ok && result.token) {
                    authToken = result.token;
                    currentUser = result.user;

                    if (!currentUser.is_admin) {
                        showAlert('Admin access required', 'error');
                        return;
                    }

                    document.getElementById('authSection').style.display = 'none';
                    document.getElementById('navTabs').style.display = 'flex';
                    showAlert(`Welcome, ${currentUser.username}!`, 'success');
                    loadDashboard();
                } else {
                    showAlert(result.error || 'Login failed', 'error');
                }
            } catch (error) {
                showAlert(`Login error: ${error.message}`, 'error');
            }
        }

        function logout() {
            authToken = '';
            currentUser = null;
            document.getElementById('authSection').style.display = 'block';
            document.getElementById('navTabs').style.display = 'none';

            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });

            showAlert('Logged out successfully', 'info');
        }

        // Navigation
        function showSection(sectionName) {
            // Update nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Show selected section
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(`${sectionName}Section`).classList.add('active');
        }

        // Dashboard functions
        async function loadDashboard() {
            try {
                const analytics = await apiCall('/api/admin/analytics');

                document.getElementById('totalUsers').textContent = analytics.total_users || 0;
                document.getElementById('totalContent').textContent = analytics.total_content || 0;
                document.getElementById('totalInteractions').textContent = analytics.total_interactions || 0;
                document.getElementById('activeUsers').textContent = analytics.active_users_last_week || 0;

                // Load support metrics
                if (analytics.support_metrics) {
                    const supportHtml = `
                        <div class="row">
                            <div class="col-6">
                                <div class="metric-card">
                                    <div class="metric-number">${analytics.support_metrics.tickets?.total || 0}</div>
                                    <div class="metric-label">Total Tickets</div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="metric-card">
                                    <div class="metric-number">${analytics.support_metrics.tickets?.open || 0}</div>
                                    <div class="metric-label">Open Tickets</div>
                                </div>
                            </div>
                        </div>
                    `;
                    document.getElementById('supportMetrics').innerHTML = supportHtml;
                }

                // Load system health
                const health = await apiCall('/api/admin/system-health');
                const healthHtml = `
                    <div class="status-item">
                        <span class="status-indicator status-${health.status === 'healthy' ? 'healthy' : 'error'}"></span>
                        Overall Status: ${health.status}
                    </div>
                    <div class="status-item">
                        <span class="status-indicator status-${health.components?.database?.status === 'healthy' ? 'healthy' : 'error'}"></span>
                        Database: ${health.components?.database?.status || 'unknown'}
                    </div>
                    <div class="status-item">
                        <span class="status-indicator status-${health.components?.cache?.status === 'healthy' ? 'healthy' : 'warning'}"></span>
                        Cache: ${health.components?.cache?.status || 'unknown'}
                    </div>
                `;
                document.getElementById('systemHealth').innerHTML = healthHtml;

            } catch (error) {
                showAlert('Failed to load dashboard', 'error');
            }
        }

        // Support functions
        async function loadSupportDashboard() {
            try {
                const dashboard = await apiCall('/api/admin/support/dashboard');

                const html = `
                    <div class="row">
                        <div class="col-3">
                            <div class="metric-card">
                                <div class="metric-number">${dashboard.metrics?.tickets?.total || 0}</div>
                                <div class="metric-label">Total Tickets</div>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="metric-card">
                                <div class="metric-number">${dashboard.metrics?.tickets?.open || 0}</div>
                                <div class="metric-label">Open Tickets</div>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="metric-card">
                                <div class="metric-number">${dashboard.metrics?.tickets?.overdue || 0}</div>
                                <div class="metric-label">Overdue Tickets</div>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="metric-card">
                                <div class="metric-number">${dashboard.unassigned_tickets || 0}</div>
                                <div class="metric-label">Unassigned</div>
                            </div>
                        </div>
                    </div>
                    
                    ${dashboard.urgent_tickets?.length > 0 ? `
                        <h4 style="margin-top: 20px;">Urgent Tickets</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Ticket #</th>
                                    <th>Subject</th>
                                    <th>Priority</th>
                                    <th>Status</th>
                                    <th>User</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${dashboard.urgent_tickets.map(ticket => `
                                    <tr>
                                        <td>${ticket.ticket_number}</td>
                                        <td>${ticket.subject}</td>
                                        <td><span class="badge badge-danger">${ticket.priority}</span></td>
                                        <td><span class="badge badge-warning">${ticket.status}</span></td>
                                        <td>${ticket.user_name}</td>
                                        <td>${new Date(ticket.created_at).toLocaleString()}</td>
                                        <td>
                                            <button onclick="viewTicketDetails(${ticket.id})" class="btn btn-primary">View</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    ` : '<p>No urgent tickets</p>'}
                `;

                document.getElementById('supportDashboardData').innerHTML = html;
            } catch (error) {
                showAlert('Failed to load support dashboard', 'error');
            }
        }

        async function loadSupportTickets(page = 1) {
            try {
                const status = document.getElementById('ticketStatus').value;
                const priority = document.getElementById('ticketPriority').value;
                const search = document.getElementById('ticketSearch').value;

                let url = `/api/admin/support/tickets?page=${page}&per_page=20`;
                if (status) url += `&status=${status}`;
                if (priority) url += `&priority=${priority}`;
                if (search) url += `&search=${encodeURIComponent(search)}`;

                const response = await apiCall(url);

                const html = `
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Ticket #</th>
                                <th>Subject</th>
                                <th>User</th>
                                <th>Priority</th>
                                <th>Status</th>
                                <th>Created</th>
                                <th>Assigned To</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${response.tickets.map(ticket => `
                                <tr>
                                    <td>${ticket.ticket_number}</td>
                                    <td>${ticket.subject}</td>
                                    <td>${ticket.user_name}<br><small>${ticket.user_email}</small></td>
                                    <td><span class="badge badge-${ticket.priority === 'urgent' ? 'danger' : ticket.priority === 'high' ? 'warning' : 'info'}">${ticket.priority}</span></td>
                                    <td><span class="badge badge-${ticket.status === 'resolved' ? 'success' : ticket.status === 'open' ? 'danger' : 'warning'}">${ticket.status}</span></td>
                                    <td>${new Date(ticket.created_at).toLocaleString()}</td>
                                    <td>${ticket.assigned_to ? ticket.assigned_to.username : 'Unassigned'}</td>
                                    <td>
                                        <button onclick="viewTicketDetails(${ticket.id})" class="btn btn-primary">View</button>
                                        <button onclick="assignTicket(${ticket.id})" class="btn btn-secondary">Assign</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <div style="margin-top: 20px;">
                        <p>Page ${response.current_page} of ${response.pages} (${response.total} total tickets)</p>
                        ${response.current_page > 1 ? `<button onclick="loadSupportTickets(${response.current_page - 1})" class="btn btn-secondary">Previous</button>` : ''}
                        ${response.current_page < response.pages ? `<button onclick="loadSupportTickets(${response.current_page + 1})" class="btn btn-secondary">Next</button>` : ''}
                    </div>
                `;

                document.getElementById('supportTicketsData').innerHTML = html;
            } catch (error) {
                showAlert('Failed to load support tickets', 'error');
            }
        }

        async function viewTicketDetails(ticketId) {
            try {
                const ticket = await apiCall(`/api/admin/support/tickets/${ticketId}`);

                const html = `
                    <div class="ticket-details">
                        <h4>Ticket #${ticket.ticket.ticket_number}</h4>
                        <div class="row">
                            <div class="col-6">
                                <p><strong>Subject:</strong> ${ticket.ticket.subject}</p>
                                <p><strong>User:</strong> ${ticket.ticket.user_name} (${ticket.ticket.user_email})</p>
                                <p><strong>Priority:</strong> <span class="badge badge-${ticket.ticket.priority === 'urgent' ? 'danger' : 'warning'}">${ticket.ticket.priority}</span></p>
                                <p><strong>Status:</strong> <span class="badge badge-info">${ticket.ticket.status}</span></p>
                            </div>
                            <div class="col-6">
                                <p><strong>Created:</strong> ${new Date(ticket.ticket.created_at).toLocaleString()}</p>
                                <p><strong>Assigned:</strong> ${ticket.ticket.assigned_to ? ticket.ticket.assigned_to.username : 'Unassigned'}</p>
                                <p><strong>SLA Deadline:</strong> ${ticket.ticket.sla_deadline ? new Date(ticket.ticket.sla_deadline).toLocaleString() : 'N/A'}</p>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <h5>Description</h5>
                            <div class="code-block">${ticket.ticket.description}</div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <h5>Conversation (${ticket.responses.length} responses)</h5>
                            <div style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 15px;">
                                ${ticket.responses.map(response => `
                                    <div style="margin-bottom: 15px; padding: 10px; background: ${response.is_from_staff ? '#e3f2fd' : '#f8f9fa'}; border-radius: 4px;">
                                        <strong>${response.is_from_staff ? response.staff_name : ticket.ticket.user_name}:</strong>
                                        <small style="float: right;">${new Date(response.created_at).toLocaleString()}</small>
                                        <p style="margin-top: 5px;">${response.message}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <h5>Add Response</h5>
                            <textarea id="ticketResponse" class="form-control" rows="3" placeholder="Enter your response..."></textarea>
                            <div style="margin-top: 10px;">
                                <select id="ticketResponseStatus" class="form-control" style="width: 200px; display: inline-block;">
                                    <option value="">Keep current status</option>
                                    <option value="in_progress">In Progress</option>
                                    <option value="resolved">Resolved</option>
                                    <option value="closed">Closed</option>
                                </select>
                                <button onclick="respondToTicket(${ticketId})" class="btn btn-success" style="margin-left: 10px;">Send Response</button>
                            </div>
                        </div>
                    </div>
                `;

                document.getElementById('ticketModalBody').innerHTML = html;
                document.getElementById('ticketModal').style.display = 'block';
            } catch (error) {
                showAlert('Failed to load ticket details', 'error');
            }
        }

        async function respondToTicket(ticketId) {
            const message = document.getElementById('ticketResponse').value;
            const status = document.getElementById('ticketResponseStatus').value;

            if (!message.trim()) {
                showAlert('Please enter a response message', 'error');
                return;
            }

            try {
                const data = { message };
                if (status) data.status = status;

                await apiCall(`/api/admin/support/tickets/${ticketId}/respond`, 'POST', data);
                showAlert('Response added successfully', 'success');
                closeModal('ticketModal');
                loadSupportTickets(); // Refresh tickets list
            } catch (error) {
                showAlert('Failed to add response', 'error');
            }
        }

        async function assignTicket(ticketId) {
            const adminId = prompt('Enter admin ID to assign (or leave empty to unassign):');

            try {
                await apiCall(`/api/admin/support/tickets/${ticketId}/assign`, 'POST', {
                    admin_id: adminId ? parseInt(adminId) : null
                });
                showAlert('Ticket assigned successfully', 'success');
                loadSupportTickets(); // Refresh tickets list
            } catch (error) {
                showAlert('Failed to assign ticket', 'error');
            }
        }

        // FAQ functions
        async function loadFAQs() {
            try {
                const response = await apiCall('/api/admin/support/faq');

                const html = `
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Question</th>
                                <th>Category</th>
                                <th>Published</th>
                                <th>Featured</th>
                                <th>Views</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${response.faqs.map(faq => `
                                <tr>
                                    <td>${faq.question}</td>
                                    <td>${faq.category ? faq.category.name : 'No category'}</td>
                                    <td><span class="badge badge-${faq.is_published ? 'success' : 'secondary'}">${faq.is_published ? 'Yes' : 'No'}</span></td>
                                    <td><span class="badge badge-${faq.is_featured ? 'warning' : 'secondary'}">${faq.is_featured ? 'Yes' : 'No'}</span></td>
                                    <td>${faq.view_count}</td>
                                    <td>
                                        <button onclick="editFAQ(${faq.id})" class="btn btn-primary">Edit</button>
                                        <button onclick="deleteFAQ(${faq.id})" class="btn btn-danger">Delete</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

                document.getElementById('faqData').innerHTML = html;
            } catch (error) {
                showAlert('Failed to load FAQs', 'error');
            }
        }

        function showCreateFAQModal() {
            document.getElementById('faqModal').style.display = 'block';
        }

        async function createFAQ() {
            const question = document.getElementById('faqQuestion').value;
            const answer = document.getElementById('faqAnswer').value;
            const categoryId = document.getElementById('faqCategoryId').value;
            const tags = document.getElementById('faqTags').value.split(',').map(tag => tag.trim()).filter(tag => tag);
            const isFeatured = document.getElementById('faqFeatured').checked;
            const isPublished = document.getElementById('faqPublished').checked;

            if (!question || !answer || !categoryId) {
                showAlert('Please fill in all required fields', 'error');
                return;
            }

            try {
                await apiCall('/api/admin/support/faq', 'POST', {
                    question,
                    answer,
                    category_id: parseInt(categoryId),
                    tags,
                    is_featured: isFeatured,
                    is_published: isPublished
                });

                showAlert('FAQ created successfully', 'success');
                closeModal('faqModal');
                loadFAQs(); // Refresh FAQ list
            } catch (error) {
                showAlert('Failed to create FAQ', 'error');
            }
        }

        async function deleteFAQ(faqId) {
            if (!confirm('Are you sure you want to delete this FAQ?')) return;

            try {
                await apiCall(`/api/admin/support/faq/${faqId}`, 'DELETE');
                showAlert('FAQ deleted successfully', 'success');
                loadFAQs(); // Refresh FAQ list
            } catch (error) {
                showAlert('Failed to delete FAQ', 'error');
            }
        }

        // Feedback functions
        async function loadFeedback() {
            try {
                const response = await apiCall('/api/admin/support/feedback');

                const html = `
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Subject</th>
                                <th>User</th>
                                <th>Type</th>
                                <th>Rating</th>
                                <th>Read</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${response.feedback.map(feedback => `
                                <tr class="${!feedback.is_read ? 'table-warning' : ''}">
                                    <td>${feedback.subject}</td>
                                    <td>${feedback.user_name}<br><small>${feedback.user_email}</small></td>
                                    <td><span class="badge badge-info">${feedback.feedback_type}</span></td>
                                    <td>${feedback.rating ? `${feedback.rating}/5 ‚≠ê` : 'N/A'}</td>
                                    <td><span class="badge badge-${feedback.is_read ? 'success' : 'warning'}">${feedback.is_read ? 'Read' : 'Unread'}</span></td>
                                    <td>${new Date(feedback.created_at).toLocaleString()}</td>
                                    <td>
                                        ${!feedback.is_read ? `<button onclick="markFeedbackRead(${feedback.id})" class="btn btn-primary">Mark Read</button>` : ''}
                                        <button onclick="viewFeedbackDetails(${feedback.id})" class="btn btn-secondary">View</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

                document.getElementById('feedbackData').innerHTML = html;
            } catch (error) {
                showAlert('Failed to load feedback', 'error');
            }
        }

        async function markFeedbackRead(feedbackId) {
            const notes = prompt('Add admin notes (optional):');

            try {
                await apiCall(`/api/admin/support/feedback/${feedbackId}/mark-read`, 'POST', {
                    admin_notes: notes || ''
                });
                showAlert('Feedback marked as read', 'success');
                loadFeedback(); // Refresh feedback list
            } catch (error) {
                showAlert('Failed to mark feedback as read', 'error');
            }
        }

        // Content management functions
        async function searchExternalContent() {
            const query = document.getElementById('contentSearchQuery').value;
            const source = document.getElementById('contentSearchSource').value;

            if (!query.trim()) {
                showAlert('Please enter a search query', 'error');
                return;
            }

            try {
                const response = await apiCall(`/api/admin/search?query=${encodeURIComponent(query)}&source=${source}`);

                const html = `
                    <h5>Search Results (${response.results.length} found)</h5>
                    <div class="row">
                        ${response.results.map(item => `
                            <div class="col-4" style="margin-bottom: 20px;">
                                <div class="card">
                                    <div class="card-body">
                                        <h6>${item.title}</h6>
                                        <p><strong>Type:</strong> ${item.content_type}</p>
                                        <p><strong>Rating:</strong> ${item.rating || 'N/A'}</p>
                                        <p><strong>Release:</strong> ${item.release_date || 'N/A'}</p>
                                        ${item.poster_path ? `<img src="${item.poster_path}" style="width: 100px; height: 150px; object-fit: cover;">` : ''}
                                        <div style="margin-top: 10px;">
                                            <button onclick="saveExternalContent(${JSON.stringify(item).replace(/"/g, '&quot;')})" class="btn btn-success">Save to Database</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;

                document.getElementById('externalContentResults').innerHTML = html;
            } catch (error) {
                showAlert('Failed to search external content', 'error');
            }
        }

        async function saveExternalContent(item) {
            try {
                await apiCall('/api/admin/content', 'POST', item);
                showAlert(`Content "${item.title}" saved successfully`, 'success');
            } catch (error) {
                showAlert('Failed to save content', 'error');
            }
        }

        async function createAdminRecommendation() {
            const contentId = document.getElementById('recContentId').value;
            const recType = document.getElementById('recType').value;
            const description = document.getElementById('recDescription').value;

            if (!contentId || !description.trim()) {
                showAlert('Please fill in all fields', 'error');
                return;
            }

            try {
                await apiCall('/api/admin/recommendations', 'POST', {
                    content_id: parseInt(contentId),
                    recommendation_type: recType,
                    description: description
                });

                showAlert('Admin recommendation created successfully', 'success');

                // Clear form
                document.getElementById('recContentId').value = '';
                document.getElementById('recDescription').value = '';
            } catch (error) {
                showAlert('Failed to create recommendation', 'error');
            }
        }

        async function loadContentManagement() {
            try {
                const response = await apiCall('/api/admin/content/manage');

                const html = `
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Title</th>
                                <th>Type</th>
                                <th>Rating</th>
                                <th>Release Date</th>
                                <th>Interactions</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${response.content.map(item => `
                                <tr>
                                    <td>${item.id}</td>
                                    <td>${item.title}</td>
                                    <td><span class="badge badge-info">${item.content_type}</span></td>
                                    <td>${item.rating || 'N/A'}</td>
                                    <td>${item.release_date ? new Date(item.release_date).toLocaleDateString() : 'N/A'}</td>
                                    <td>${item.interaction_count}</td>
                                    <td>
                                        <button onclick="window.open('/api/details/${item.slug}', '_blank')" class="btn btn-primary">View</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

                document.getElementById('contentManagementData').innerHTML = html;
            } catch (error) {
                showAlert('Failed to load content management', 'error');
            }
        }

        async function loadAdminRecommendations() {
            try {
                const response = await apiCall('/api/admin/recommendations');

                const html = `
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Content</th>
                                <th>Type</th>
                                <th>Description</th>
                                <th>Admin</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${response.recommendations.map(rec => `
                                <tr>
                                    <td>
                                        <div style="display: flex; align-items: center;">
                                            ${rec.content.poster_path ? `<img src="${rec.content.poster_path}" style="width: 40px; height: 60px; margin-right: 10px; object-fit: cover;">` : ''}
                                            <div>
                                                <strong>${rec.content.title}</strong><br>
                                                <small>${rec.content.content_type} ‚Ä¢ ${rec.content.rating || 'N/A'}/10</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td><span class="badge badge-warning">${rec.recommendation_type}</span></td>
                                    <td>${rec.description}</td>
                                    <td>${rec.admin_name}</td>
                                    <td>${new Date(rec.created_at).toLocaleString()}</td>
                                    <td>
                                        <button onclick="window.open('/api/details/${rec.content.slug}', '_blank')" class="btn btn-primary">View Content</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

                document.getElementById('adminRecommendationsData').innerHTML = html;
            } catch (error) {
                showAlert('Failed to load admin recommendations', 'error');
            }
        }

        // User management functions
        async function loadUsers() {
            try {
                const search = document.getElementById('userSearch').value;
                let url = '/api/admin/users';
                if (search) url += `?search=${encodeURIComponent(search)}`;

                const response = await apiCall(url);

                const html = `
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Email</th>
                                <th>Admin</th>
                                <th>Joined</th>
                                <th>Last Active</th>
                                <th>Interactions</th>
                                <th>Support Tickets</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${response.users.map(user => `
                                <tr>
                                    <td>${user.username}</td>
                                    <td>${user.email}</td>
                                    <td><span class="badge badge-${user.is_admin ? 'success' : 'secondary'}">${user.is_admin ? 'Yes' : 'No'}</span></td>
                                    <td>${new Date(user.created_at).toLocaleDateString()}</td>
                                    <td>${user.last_active ? new Date(user.last_active).toLocaleDateString() : 'Never'}</td>
                                    <td>${user.total_interactions}</td>
                                    <td>${user.total_support_tickets}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

                document.getElementById('usersData').innerHTML = html;
            } catch (error) {
                showAlert('Failed to load users', 'error');
            }
        }

        // Analytics functions
        async function loadAnalytics() {
            try {
                const analytics = await apiCall('/api/admin/analytics');

                const html = `
                    <div class="row">
                        <div class="col-6">
                            <h4>Popular Content</h4>
                            <table class="table">
                                <thead>
                                    <tr><th>Title</th><th>Interactions</th></tr>
                                </thead>
                                <tbody>
                                    ${analytics.popular_content.map(item => `
                                        <tr>
                                            <td>${item.title}</td>
                                            <td>${item.interactions}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        <div class="col-6">
                            <h4>Popular Genres</h4>
                            <table class="table">
                                <thead>
                                    <tr><th>Genre</th><th>Count</th></tr>
                                </thead>
                                <tbody>
                                    ${analytics.popular_genres.map(item => `
                                        <tr>
                                            <td>${item.genre}</td>
                                            <td>${item.count}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-6">
                            <h4>Interactions by Type</h4>
                            <table class="table">
                                <thead>
                                    <tr><th>Type</th><th>Count</th></tr>
                                </thead>
                                <tbody>
                                    ${analytics.interactions_by_type.map(item => `
                                        <tr>
                                            <td>${item.type}</td>
                                            <td>${item.count}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        <div class="col-6">
                            <h4>Content by Type</h4>
                            <table class="table">
                                <thead>
                                    <tr><th>Type</th><th>Count</th></tr>
                                </thead>
                                <tbody>
                                    ${analytics.content_by_type.map(item => `
                                        <tr>
                                            <td>${item.type}</td>
                                            <td>${item.count}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;

                document.getElementById('analyticsData').innerHTML = html;
            } catch (error) {
                showAlert('Failed to load analytics', 'error');
            }
        }

        // System management functions
        async function clearCache(type) {
            if (!confirm(`Are you sure you want to clear ${type} cache?`)) return;

            try {
                await apiCall(`/api/admin/cache/clear?type=${type}`, 'POST');
                showAlert(`${type} cache cleared successfully`, 'success');
            } catch (error) {
                showAlert('Failed to clear cache', 'error');
            }
        }

        async function loadCacheStats() {
            try {
                const stats = await apiCall('/api/admin/cache/stats');

                const html = `
                    <h4>Cache Statistics</h4>
                    <div class="code-block">
                        <strong>Type:</strong> ${stats.type}<br>
                        <strong>Default Timeout:</strong> ${stats.default_timeout} seconds<br>
                        ${stats.redis ? `
                            <strong>Redis Stats:</strong><br>
                            - Used Memory: ${stats.redis.used_memory}<br>
                            - Connected Clients: ${stats.redis.connected_clients}<br>
                            - Commands Processed: ${stats.redis.total_commands_processed}<br>
                            - Uptime: ${Math.floor(stats.redis.uptime_in_seconds / 3600)} hours
                        ` : ''}
                        ${stats.support_queues ? `
                            <br><strong>Support Queues:</strong><br>
                            - Admin Notifications: ${stats.support_queues.admin_notifications}<br>
                            - Admin Emails: ${stats.support_queues.admin_emails}<br>
                            - Dashboard Notifications: ${stats.support_queues.dashboard_notifications}
                        ` : ''}
                    </div>
                `;

                document.getElementById('systemData').innerHTML = html;
            } catch (error) {
                showAlert('Failed to load cache stats', 'error');
            }
        }

        async function loadSystemHealth() {
            try {
                const health = await apiCall('/api/admin/system-health');

                const html = `
                    <h4>System Health Check</h4>
                    <div class="row">
                        <div class="col-12">
                            <div style="padding: 15px; background: ${health.status === 'healthy' ? '#d4edda' : '#f8d7da'}; border-radius: 4px; margin-bottom: 15px;">
                                <h5>Overall Status: <span class="badge badge-${health.status === 'healthy' ? 'success' : 'danger'}">${health.status.toUpperCase()}</span></h5>
                                <small>Last checked: ${new Date(health.timestamp).toLocaleString()}</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        ${Object.entries(health.components).map(([component, data]) => `
                            <div class="col-4" style="margin-bottom: 15px;">
                                <div class="card">
                                    <div class="card-header">
                                        <span class="status-indicator status-${data.status === 'healthy' ? 'healthy' : data.status === 'degraded' ? 'warning' : 'error'}"></span>
                                        ${component.replace('_', ' ').toUpperCase()}
                                    </div>
                                    <div class="card-body">
                                        <p><strong>Status:</strong> ${data.status}</p>
                                        ${data.total_users ? `<p><strong>Users:</strong> ${data.total_users}</p>` : ''}
                                        ${data.total_content ? `<p><strong>Content:</strong> ${data.total_content}</p>` : ''}
                                        ${data.total_tickets ? `<p><strong>Tickets:</strong> ${data.total_tickets}</p>` : ''}
                                        ${data.error ? `<p style="color: red;"><strong>Error:</strong> ${data.error}</p>` : ''}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;

                document.getElementById('systemData').innerHTML = html;
            } catch (error) {
                showAlert('Failed to load system health', 'error');
            }
        }

        // Notification functions
        async function loadNotifications() {
            try {
                const response = await apiCall('/api/admin/notifications');

                const html = `
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Message</th>
                                <th>Type</th>
                                <th>Priority</th>
                                <th>Time</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${response.notifications.map(notification => `
                                <tr class="${!notification.read ? 'table-warning' : ''}">
                                    <td>${notification.title}</td>
                                    <td>${notification.message.substring(0, 100)}${notification.message.length > 100 ? '...' : ''}</td>
                                    <td><span class="badge badge-info">${notification.type}</span></td>
                                    <td><span class="badge badge-${notification.priority === 'urgent' ? 'danger' : notification.priority === 'high' ? 'warning' : 'info'}">${notification.priority}</span></td>
                                    <td>${new Date(notification.timestamp).toLocaleString()}</td>
                                    <td><span class="badge badge-${notification.read ? 'success' : 'warning'}">${notification.read ? 'Read' : 'Unread'}</span></td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

                document.getElementById('notificationsData').innerHTML = html;
            } catch (error) {
                showAlert('Failed to load notifications', 'error');
            }
        }

        async function sendTestNotification() {
            try {
                // This would typically be done automatically by the system
                // For testing, we can create a dummy notification
                showAlert('Test notification feature would be triggered by system events', 'info');
            } catch (error) {
                showAlert('Failed to send test notification', 'error');
            }
        }

        // Modal functions
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function toggleNotificationsPanel() {
            const panel = document.getElementById('notificationsPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function () {
            // Auto-load dashboard if already authenticated
            if (authToken) {
                loadDashboard();
            }

            // Enter key for login
            document.getElementById('loginPassword').addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    adminLogin();
                }
            });

            // Close modals when clicking outside
            window.onclick = function (event) {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    if (event.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            };
        });

        // Auto-refresh dashboard every 30 seconds
        setInterval(() => {
            if (authToken && document.querySelector('.nav-tab.active')?.textContent?.includes('Dashboard')) {
                loadDashboard();
            }
        }, 30000);

        // Show notifications panel on page load
        setTimeout(() => {
            document.getElementById('notificationsPanel').style.display = 'block';
        }, 2000);
    </script>
</body>

</html>