<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - CineRec</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/bootstrap.min.css" rel="stylesheet">
    <style>body{background:linear-gradient(135deg,#2c3e50,#3498db);min-height:100vh;font-family:Arial}.admin-card{background:rgba(255,255,255,0.1);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.2);border-radius:15px}.movie-preview{max-width:200px;border-radius:10px}</style>
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="admin-card p-4">
                    <h2 class="text-white text-center mb-4">üé¨ Admin Panel</h2>
                    
                    <!-- Movie Search -->
                    <div class="mb-4">
                        <label class="form-label text-white">Search Movie to Feature:</label>
                        <div class="input-group">
                            <input type="text" id="movieSearch" class="form-control" placeholder="Search movie title...">
                            <button class="btn btn-outline-light" onclick="searchMovie()">Search</button>
                        </div>
                    </div>

                    <!-- Movie Results -->
                    <div id="movieResults" class="mb-4"></div>

                    <!-- Feature Form -->
                    <div id="featureForm" class="d-none">
                        <div class="mb-3">
                            <label class="form-label text-white">Custom Message:</label>
                            <textarea id="customMessage" class="form-control" rows="4" 
                                placeholder="Write a custom recommendation message..."></textarea>
                        </div>
                        <div class="text-center">
                            <button class="btn btn-success me-2" onclick="postToWebsite()">Post to Website</button>
                            <button class="btn btn-primary" onclick="postToTelegram()">Post to Telegram</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE = 'https://your-backend-url.onrender.com';
        let selectedMovie = null;

        async function searchMovie() {
            const query = document.getElementById('movieSearch').value;
            if (!query) return;

            try {
                const response = await fetch(`${API_BASE}/search?q=${query}`);
                const data = await response.json();
                displayMovieResults(data.results.filter(item => item.media_type === 'movie').slice(0, 5));
            } catch (error) {
                console.error('Search error:', error);
            }
        }

        function displayMovieResults(movies) {
            const container = document.getElementById('movieResults');
            container.innerHTML = `
                <h5 class="text-white mb-3">Select Movie to Feature:</h5>
                <div class="row">
                    ${movies.map(movie => `
                        <div class="col-md-6 mb-3">
                            <div class="card bg-dark text-white" style="cursor:pointer" onclick="selectMovie(${movie.id}, '${movie.title}', '${movie.poster_path}', '${movie.overview.replace(/'/g, "\\'")}')">
                                <div class="row g-0">
                                    <div class="col-4">
                                        <img src="https://image.tmdb.org/t/p/w200${movie.poster_path}" class="img-fluid rounded-start h-100" style="object-fit:cover">
                                    </div>
                                    <div class="col-8">
                                        <div class="card-body">
                                            <h6 class="card-title">${movie.title}</h6>
                                            <p class="card-text small">${movie.release_date?.split('-')[0]} ‚Ä¢ ‚≠ê ${movie.vote_average.toFixed(1)}</p>
                                            <p class="card-text small">${movie.overview.substring(0, 100)}...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function selectMovie(id, title, poster, overview) {
            selectedMovie = {id, title, poster, overview};
            document.getElementById('featureForm').classList.remove('d-none');
            document.getElementById('customMessage').value = `üé¨ Featured Movie: ${title}\n\n${overview}\n\nDon't miss this amazing film!`;
        }

        async function postToWebsite() {
            if (!selectedMovie) return;
            
            try {
                const response = await fetch(`${API_BASE}/admin/post-suggestion`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        movie_id: selectedMovie.id,
                        message: document.getElementById('customMessage').value,
                        platform: 'website'
                    })
                });
                
                const result = await response.json();
                alert(result.success ? 'Posted to website successfully!' : 'Failed to post to website');
            } catch (error) {
                alert('Error posting to website');
            }
        }

        async function postToTelegram() {
            if (!selectedMovie) return;
            
            try {
                const response = await fetch(`${API_BASE}/admin/post-suggestion`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        movie_id: selectedMovie.id,
                        message: document.getElementById('customMessage').value,
                        platform: 'telegram'
                    })
                });
                
                const result = await response.json();
                alert(result.success ? 'Posted to Telegram successfully!' : 'Failed to post to Telegram');
            } catch (error) {
                alert('Error posting to Telegram');
            }
        }
    </script>
</body>
</html>