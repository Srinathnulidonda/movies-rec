<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CineStream - Movie & TV Recommendations</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --bg-primary: #0f0f0f; --bg-secondary: #1a1a1a; --bg-card: #2a2a2a; --text-primary: #ffffff; --text-secondary: #b3b3b3; --accent: #e50914; --accent-hover: #f40612; --border: #3a3a3a; --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        [data-theme="light"] { --bg-primary: #ffffff; --bg-secondary: #f8f9fa; --bg-card: #ffffff; --text-primary: #212529; --text-secondary: #6c757d; --border: #dee2e6; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg-primary); color: var(--text-primary); transition: all 0.3s ease; overflow-x: hidden; }
        .navbar { background: var(--bg-secondary) !important; border-bottom: 1px solid var(--border); backdrop-filter: blur(10px); }
        .navbar-brand { font-weight: 700; font-size: 1.5rem; color: var(--accent) !important; }
        .nav-link { color: var(--text-primary) !important; transition: color 0.3s ease; }
        .nav-link:hover { color: var(--accent) !important; }
        .hero { background: var(--gradient); min-height: 60vh; display: flex; align-items: center; position: relative; overflow: hidden; }
        .hero::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><polygon fill="rgba(255,255,255,0.1)" points="0,1000 1000,0 1000,1000"/></svg>'); }
        .hero-content { position: relative; z-index: 2; }
        .hero h1 { font-size: 3.5rem; font-weight: 700; margin-bottom: 1rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .hero p { font-size: 1.25rem; margin-bottom: 2rem; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); }
        .btn-primary { background: var(--accent); border: none; padding: 12px 30px; font-weight: 600; transition: all 0.3s ease; }
        .btn-primary:hover { background: var(--accent-hover); transform: translateY(-2px); box-shadow: 0 8px 25px rgba(229,9,20,0.3); }
        .card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; transition: all 0.3s ease; overflow: hidden; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .card-img-top { height: 300px; object-fit: cover; transition: transform 0.3s ease; }
        .card:hover .card-img-top { transform: scale(1.05); }
        .card-body { padding: 1.5rem; }
        .card-title { color: var(--text-primary); font-weight: 600; margin-bottom: 0.5rem; }
        .card-text { color: var(--text-secondary); font-size: 0.9rem; }
        .section-title { font-size: 2rem; font-weight: 700; margin-bottom: 2rem; color: var(--text-primary); }
        .content-slider { display: flex; overflow-x: auto; gap: 1rem; padding: 1rem 0; scroll-behavior: smooth; }
        .content-slider::-webkit-scrollbar { height: 8px; }
        .content-slider::-webkit-scrollbar-track { background: var(--bg-secondary); border-radius: 4px; }
        .content-slider::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 4px; }
        .content-item { flex: 0 0 250px; }
        .rating { color: #ffc107; }
        .genre-badge { background: var(--accent); color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem; margin-right: 0.5rem; margin-bottom: 0.5rem; display: inline-block; }
        .search-container { position: relative; max-width: 600px; margin: 0 auto; }
        .search-input { background: var(--bg-card); border: 1px solid var(--border); color: var(--text-primary); padding: 15px 50px 15px 20px; border-radius: 50px; width: 100%; transition: all 0.3s ease; }
        .search-input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(229,9,20,0.1); }
        .search-btn { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: var(--accent); border: none; color: white; padding: 10px 15px; border-radius: 50%; }
        .theme-toggle { background: var(--bg-card); border: 1px solid var(--border); color: var(--text-primary); padding: 8px 12px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; }
        .theme-toggle:hover { background: var(--accent); color: white; }
        .loading { text-align: center; padding: 3rem; }
        .spinner { border: 4px solid var(--border); border-top: 4px solid var(--accent); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 1rem; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .modal-content { background: var(--bg-card); border: 1px solid var(--border); }
        .modal-header { border-bottom: 1px solid var(--border); }
        .modal-footer { border-top: 1px solid var(--border); }
        .auth-form { max-width: 400px; margin: 0 auto; padding: 2rem; }
        .form-control { background: var(--bg-card); border: 1px solid var(--border); color: var(--text-primary); }
        .form-control:focus { background: var(--bg-card); border-color: var(--accent); color: var(--text-primary); box-shadow: 0 0 0 3px rgba(229,9,20,0.1); }
        .interaction-btn { background: transparent; border: 1px solid var(--border); color: var(--text-secondary); padding: 8px 12px; border-radius: 8px; transition: all 0.3s ease; margin-right: 0.5rem; }
        .interaction-btn:hover { background: var(--accent); color: white; border-color: var(--accent); }
        .interaction-btn.active { background: var(--accent); color: white; border-color: var(--accent); }
        @media (max-width: 768px) { .hero h1 { font-size: 2.5rem; } .hero p { font-size: 1rem; } .content-item { flex: 0 0 200px; } }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#"><i class="fas fa-film me-2"></i>CineStream</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item"><a class="nav-link" href="#home">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="#movies">Movies</a></li>
                    <li class="nav-item"><a class="nav-link" href="#tv">TV Shows</a></li>
                    <li class="nav-item"><a class="nav-link" href="#anime">Anime</a></li>
                </ul>
                <div class="d-flex align-items-center">
                    <button class="theme-toggle me-3" onclick="toggleTheme()">
                        <i class="fas fa-moon"></i>
                    </button>
                    <div id="auth-buttons">
                        <button class="btn btn-outline-light me-2" onclick="showAuth('login')">Login</button>
                        <button class="btn btn-primary" onclick="showAuth('register')">Sign Up</button>
                    </div>
                    <div id="user-menu" class="d-none">
                        <span id="username" class="me-3"></span>
                        <button class="btn btn-outline-light" onclick="logout()">Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main style="padding-top: 76px;">
        <section class="hero" id="home">
            <div class="container">
                <div class="hero-content text-center text-white">
                    <h1 class="fade-in">Discover Your Next Favorite</h1>
                    <p class="fade-in">Personalized movie and TV show recommendations powered by AI</p>
                    <div class="search-container fade-in">
                        <input type="text" class="search-input" placeholder="Search movies, TV shows, anime..." id="searchInput">
                        <button class="search-btn" onclick="searchContent()">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <div class="container my-5">
            <div id="search-results" class="d-none">
                <h2 class="section-title">Search Results</h2>
                <div id="search-content" class="row g-4"></div>
            </div>

            <section id="trending" class="mb-5">
                <h2 class="section-title">Trending Now</h2>
                <div id="trending-content" class="content-slider"></div>
            </section>

            <section id="personalized" class="mb-5 d-none">
                <h2 class="section-title">Recommended for You</h2>
                <div id="personalized-content" class="content-slider"></div>
            </section>

            <section id="genres" class="mb-5">
                <h2 class="section-title">Popular by Genre</h2>
                <div class="row g-4">
                    <div class="col-md-6">
                        <h4>Action</h4>
                        <div id="action-content" class="content-slider"></div>
                    </div>
                    <div class="col-md-6">
                        <h4>Comedy</h4>
                        <div id="comedy-content" class="content-slider"></div>
                    </div>
                </div>
            </section>

            <section id="regional" class="mb-5">
                <h2 class="section-title">Regional Content</h2>
                <div class="row g-4">
                    <div class="col-md-3">
                        <h5>Telugu</h5>
                        <div id="telugu-content" class="content-slider"></div>
                    </div>
                    <div class="col-md-3">
                        <h5>Hindi</h5>
                        <div id="hindi-content" class="content-slider"></div>
                    </div>
                    <div class="col-md-3">
                        <h5>Tamil</h5>
                        <div id="tamil-content" class="content-slider"></div>
                    </div>
                    <div class="col-md-3">
                        <h5>Kannada</h5>
                        <div id="kannada-content" class="content-slider"></div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Auth Modal -->
    <div class="modal fade" id="authModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="authModalTitle">Login</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="authForm" class="auth-form">
                        <div class="mb-3" id="emailField" style="display: none;">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Username</label>
                            <input type="text" class="form-control" id="username" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" id="password" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Login</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Content Detail Modal -->
    <div class="modal fade" id="contentModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="contentTitle"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4">
                            <img id="contentPoster" class="img-fluid rounded" alt="">
                        </div>
                        <div class="col-md-8">
                            <p id="contentOverview"></p>
                            <div class="mb-3">
                                <span class="rating me-2">
                                    <i class="fas fa-star"></i>
                                    <span id="contentRating"></span>
                                </span>
                                <span id="contentGenres"></span>
                            </div>
                            <div id="contentInteractions" class="d-none">
                                <button class="interaction-btn" onclick="interact('like')">
                                    <i class="fas fa-thumbs-up"></i> Like
                                </button>
                                <button class="interaction-btn" onclick="interact('favorite')">
                                    <i class="fas fa-heart"></i> Favorite
                                </button>
                                <button class="interaction-btn" onclick="interact('wishlist')">
                                    <i class="fas fa-bookmark"></i> Wishlist
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE = 'https://backend-app-970m.onrender.com/api';
        let currentUser = null;
        let authToken = null;
        let currentContentId = null;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthStatus();
            loadHomepage();
            setupEventListeners();
        });

        function setupEventListeners() {
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') searchContent();
            });

            document.getElementById('authForm').addEventListener('submit', function(e) {
                e.preventDefault();
                submitAuth();
            });
        }

        function checkAuthStatus() {
            authToken = localStorage.getItem('authToken');
            if (authToken) {
                currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                showUserMenu();
                loadPersonalizedContent();
            }
        }

        function showUserMenu() {
            document.getElementById('auth-buttons').classList.add('d-none');
            document.getElementById('user-menu').classList.remove('d-none');
            document.getElementById('username').textContent = currentUser.username || 'User';
            document.getElementById('personalized').classList.remove('d-none');
            document.getElementById('contentInteractions').classList.remove('d-none');
        }

        function hideUserMenu() {
            document.getElementById('auth-buttons').classList.remove('d-none');
            document.getElementById('user-menu').classList.add('d-none');
            document.getElementById('personalized').classList.add('d-none');
            document.getElementById('contentInteractions').classList.add('d-none');
        }

        async function loadHomepage() {
            showLoading('trending-content');
            try {
                const response = await fetch(`${API_BASE}/homepage`);
                const data = await response.json();
                
                renderContent(data.trending.movies, 'trending-content');
                renderContent(data.popular_by_genre.Action, 'action-content');
                renderContent(data.popular_by_genre.Comedy, 'comedy-content');
                renderContent(data.regional.Telugu, 'telugu-content');
                renderContent(data.regional.Hindi, 'hindi-content');
                renderContent(data.regional.Tamil, 'tamil-content');
                renderContent(data.regional.Kannada, 'kannada-content');
            } catch (error) {
                console.error('Error loading homepage:', error);
            }
        }

        async function loadPersonalizedContent() {
            if (!authToken) return;
            
            showLoading('personalized-content');
            try {
                const response = await fetch(`${API_BASE}/recommendations`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const data = await response.json();
                renderContent(data.hybrid_recommendations, 'personalized-content');
            } catch (error) {
                console.error('Error loading personalized content:', error);
            }
        }

        function renderContent(items, containerId) {
            const container = document.getElementById(containerId);
            if (!items || items.length === 0) {
                container.innerHTML = '<p class="text-muted">No content available</p>';
                return;
            }

            container.innerHTML = items.map(item => `
                <div class="content-item">
                    <div class="card" onclick="showContentDetail(${item.id || item.tmdb_id})">
                        <img src="${item.poster_path ? `https://image.tmdb.org/t/p/w300${item.poster_path}` : 'https://via.placeholder.com/300x450?text=No+Image'}" 
                             class="card-img-top" alt="${item.title || item.name}">
                        <div class="card-body">
                            <h6 class="card-title">${item.title || item.name}</h6>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="rating">
                                    <i class="fas fa-star"></i>
                                    ${item.vote_average || item.rating || 'N/A'}
                                </span>
                                <small class="text-muted">${item.release_date || item.first_air_date || ''}</small>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function searchContent() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;

            document.getElementById('search-results').classList.remove('d-none');
            showLoading('search-content');

            try {
                const response = await fetch(`${API_BASE}/search?q=${encodeURIComponent(query)}`);
                const data = await response.json();
                
                const allResults = [...(data.database_results || []), ...(data.tmdb_results || [])];
                renderSearchResults(allResults);
            } catch (error) {
                console.error('Error searching content:', error);
            }
        }

        function renderSearchResults(results) {
            const container = document.getElementById('search-content');
            if (!results || results.length === 0) {
                container.innerHTML = '<p class="text-muted">No results found</p>';
                return;
            }

            container.innerHTML = results.map(item => `
                <div class="col-md-3">
                    <div class="card" onclick="showContentDetail(${item.id || item.tmdb_id})">
                        <img src="${item.poster_path ? `https://image.tmdb.org/t/p/w300${item.poster_path}` : 'https://via.placeholder.com/300x450?text=No+Image'}" 
                             class="card-img-top" alt="${item.title || item.name}">
                        <div class="card-body">
                            <h6 class="card-title">${item.title || item.name}</h6>
                            <p class="card-text">${(item.overview || '').substring(0, 100)}...</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="rating">
                                    <i class="fas fa-star"></i>
                                    ${item.vote_average || item.rating || 'N/A'}
                                </span>
                                <small class="text-muted">${item.release_date || item.first_air_date || ''}</small>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function showContentDetail(contentId) {
            currentContentId = contentId;
            try {
                const response = await fetch(`${API_BASE}/content/${contentId}`);
                const data = await response.json();
                
                document.getElementById('contentTitle').textContent = data.content.title;
                document.getElementById('contentOverview').textContent = data.content.overview || 'No overview available';
                document.getElementById('contentRating').textContent = data.content.rating || 'N/A';
                document.getElementById('contentPoster').src = data.content.poster_path ? 
                    `https://image.tmdb.org/t/p/w300${data.content.poster_path}` : 
                    'https://via.placeholder.com/300x450?text=No+Image';
                
                if (data.content.genres) {
                    document.getElementById('contentGenres').innerHTML = data.content.genres.map(genre => 
                        `<span class="genre-badge">${genre}</span>`
                    ).join('');
                }
                
                new bootstrap.Modal(document.getElementById('contentModal')).show();
            } catch (error) {
                console.error('Error loading content details:', error);
            }
        }

        function showAuth(type) {
            const modal = new bootstrap.Modal(document.getElementById('authModal'));
            const title = document.getElementById('authModalTitle');
            const emailField = document.getElementById('emailField');
            const submitBtn = document.querySelector('#authForm button[type="submit"]');
            
            if (type === 'register') {
                title.textContent = 'Sign Up';
                emailField.style.display = 'block';
                submitBtn.textContent = 'Sign Up';
                document.getElementById('email').required = true;
            } else {
                title.textContent = 'Login';
                emailField.style.display = 'none';
                submitBtn.textContent = 'Login';
                document.getElementById('email').required = false;
            }
            
            modal.show();
        }

        async function submitAuth() {
            const isRegister = document.getElementById('authModalTitle').textContent === 'Sign Up';
            const endpoint = isRegister ? 'register' : 'login';
            
            const formData = {
                username: document.getElementById('username').value,
                password: document.getElementById('password').value
            };
            
            if (isRegister) {
                formData.email = document.getElementById('email').value;
            }
            
            try {
                const response = await fetch(`${API_BASE}/${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    authToken = data.token;
                    currentUser = { username: formData.username, id: data.user_id };
                    localStorage.setItem('authToken', authToken);
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    showUserMenu();
                    loadPersonalizedContent();
                    bootstrap.Modal.getInstance(document.getElementById('authModal')).hide();
                    document.getElementById('authForm').reset();
                } else {
                    alert(data.error || 'Authentication failed');
                }
            } catch (error) {
                console.error('Auth error:', error);
                alert('Authentication failed');
            }
        }

        function logout() {
            authToken = null;
            currentUser = null;
            localStorage.removeItem('authToken');
            localStorage.removeItem('currentUser');
            hideUserMenu();
        }

        async function interact(type) {
            if (!authToken || !currentContentId) return;
            
            try {
                const response = await fetch(`${API_BASE}/interact`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        content_id: currentContentId,
                        interaction_type: type,
                        rating: type === 'like' ? 5 : undefined
                    })
                });
                
                if (response.ok) {
                    const button = event.target.closest('.interaction-btn');
                    button.classList.add('active');
                    setTimeout(() => button.classList.remove('active'), 2000);
                }
            } catch (error) {
                console.error('Interaction error:', error);
            }
        }

        function toggleTheme() {
            const body = document.body;
            const icon = document.querySelector('.theme-toggle i');
            
            if (body.getAttribute('data-theme') === 'light') {
                body.removeAttribute('data-theme');
                icon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'dark');
            } else {
                body.setAttribute('data-theme', 'light');
                icon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'light');
            }
        }



        async function submitAuth() {
    const isRegister = document.getElementById('authModalTitle').textContent === 'Sign Up';
    const endpoint = isRegister ? 'register' : 'login';
    
    const formData = {
        username: document.getElementById('username').value,
        password: document.getElementById('password').value
    };
    
    if (isRegister) {
        formData.email = document.getElementById('email').value;
    }
    
    try {
        const response = await fetch(`${API_BASE}/${endpoint}`, {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (response.ok) {
            authToken = data.token;
            currentUser = { username: data.username, id: data.user_id }; // Changed to use data.username from response
            localStorage.setItem('authToken', authToken);
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            showUserMenu();
            loadPersonalizedContent();
            bootstrap.Modal.getInstance(document.getElementById('authModal')).hide();
            document.getElementById('authForm').reset();
        } else {
            alert(data.error || 'Authentication failed');
        }
    } catch (error) {
        console.error('Auth error:', error);
        alert('Network error. Please try again.');
    }
}

        function showLoading(containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading content...</p>
                </div>
            `;
        }

        // Initialize theme
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'light') {
            document.body.setAttribute('data-theme', 'light');
            document.querySelector('.theme-toggle i').className = 'fas fa-sun';
        }
    </script>
</body>
</html>