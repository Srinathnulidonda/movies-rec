<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Recommendations</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hover { transition: transform 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); }
        .glass-effect { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.1); }
        .loading { animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <!-- Navigation -->
    <nav class="bg-gray-800 shadow-lg">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <i class="fas fa-film text-2xl text-purple-400"></i>
                    <h1 class="text-xl font-bold">MovieRecs</h1>
                </div>
                <div class="hidden md:flex items-center space-x-6">
                    <a href="#" class="nav-link" data-page="home">Home</a>
                    <a href="#" class="nav-link" data-page="search">Search</a>
                    <a href="#" class="nav-link" data-page="trending">Trending</a>
                    <a href="#" class="nav-link" data-page="watchlist">Watchlist</a>
                </div>
                <div class="flex items-center space-x-4">
                    <div id="auth-buttons" class="space-x-2">
                        <button id="login-btn" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded">Login</button>
                        <button id="register-btn" class="bg-transparent border border-purple-600 hover:bg-purple-600 px-4 py-2 rounded">Register</button>
                    </div>
                    <div id="user-menu" class="hidden">
                        <span id="username" class="mr-2"></span>
                        <button id="logout-btn" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded">Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
        <!-- Home Page -->
        <div id="home-page" class="page">
            <div class="gradient-bg rounded-lg p-8 mb-8">
                <h2 class="text-4xl font-bold mb-4">Discover Your Next Favorite</h2>
                <p class="text-lg opacity-90 mb-6">Get personalized movie and TV show recommendations powered by AI</p>
                <div class="flex space-x-4">
                    <button class="bg-white text-purple-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100">
                        Get Started
                    </button>
                    <button class="border border-white px-6 py-3 rounded-lg font-semibold hover:bg-white hover:text-purple-600">
                        Learn More
                    </button>
                </div>
            </div>

            <!-- Featured Content -->
            <div id="featured-section" class="mb-8">
                <h3 class="text-2xl font-bold mb-4">Featured Content</h3>
                <div id="featured-content" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
            </div>

            <!-- Recommendations -->
            <div id="recommendations-section" class="mb-8">
                <h3 class="text-2xl font-bold mb-4">Recommended for You</h3>
                <div id="recommendations-content" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
            </div>
        </div>

        <!-- Search Page -->
        <div id="search-page" class="page hidden">
            <div class="mb-8">
                <h2 class="text-3xl font-bold mb-4">Search Content</h2>
                <div class="flex space-x-4 mb-4">
                    <input type="text" id="search-input" placeholder="Search movies, TV shows, anime..." 
                           class="flex-1 px-4 py-2 rounded-lg bg-gray-800 border border-gray-600 focus:border-purple-500 focus:outline-none">
                    <select id="search-type" class="px-4 py-2 rounded-lg bg-gray-800 border border-gray-600">
                        <option value="all">All</option>
                        <option value="movie">Movies</option>
                        <option value="tv">TV Shows</option>
                        <option value="anime">Anime</option>
                    </select>
                    <button id="search-btn" class="bg-purple-600 hover:bg-purple-700 px-6 py-2 rounded-lg">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
            <div id="search-results" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
        </div>

        <!-- Trending Page -->
        <div id="trending-page" class="page hidden">
            <div class="mb-8">
                <h2 class="text-3xl font-bold mb-4">Trending Now</h2>
                <div class="flex space-x-4 mb-4">
                    <button class="trending-filter active bg-purple-600 px-4 py-2 rounded" data-type="all">All</button>
                    <button class="trending-filter bg-gray-600 px-4 py-2 rounded" data-type="movie">Movies</button>
                    <button class="trending-filter bg-gray-600 px-4 py-2 rounded" data-type="tv">TV Shows</button>
                    <button class="trending-filter bg-gray-600 px-4 py-2 rounded" data-type="anime">Anime</button>
                </div>
            </div>
            <div id="trending-content" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
        </div>

        <!-- Watchlist Page -->
        <div id="watchlist-page" class="page hidden">
            <div class="mb-8">
                <h2 class="text-3xl font-bold mb-4">My Watchlist</h2>
                <p class="text-gray-400">Your saved movies and shows</p>
            </div>
            <div id="watchlist-content" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
        </div>
    </div>

    <!-- Content Card Template -->
    <template id="content-card-template">
        <div class="bg-gray-800 rounded-lg overflow-hidden shadow-lg card-hover">
            <div class="relative">
                <img class="w-full h-64 object-cover" src="" alt="">
                <div class="absolute top-2 right-2 bg-black bg-opacity-50 px-2 py-1 rounded">
                    <span class="rating text-yellow-400">
                        <i class="fas fa-star"></i> <span class="rating-value"></span>
                    </span>
                </div>
                <div class="absolute bottom-2 left-2 bg-purple-600 px-2 py-1 rounded text-xs content-type"></div>
            </div>
            <div class="p-4">
                <h3 class="font-bold text-lg mb-2 content-title"></h3>
                <p class="text-gray-400 text-sm mb-3 content-overview"></p>
                <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-500 release-date"></span>
                    <div class="flex space-x-2">
                        <button class="watchlist-btn bg-gray-600 hover:bg-gray-700 p-2 rounded">
                            <i class="fas fa-bookmark"></i>
                        </button>
                        <button class="rate-btn bg-purple-600 hover:bg-purple-700 p-2 rounded">
                            <i class="fas fa-star"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Auth Modal -->
    <div id="auth-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-gray-800 p-8 rounded-lg max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 id="auth-title" class="text-xl font-bold">Login</h3>
                <button id="close-modal" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="auth-form">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Username</label>
                    <input type="text" id="auth-username" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:border-purple-500" required>
                </div>
                <div id="email-field" class="mb-4 hidden">
                    <label class="block text-sm font-medium mb-2">Email</label>
                    <input type="email" id="auth-email" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:border-purple-500">
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2">Password</label>
                    <input type="password" id="auth-password" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:border-purple-500" required>
                </div>
                <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 py-2 rounded-lg font-semibold">
                    <span id="auth-submit-text">Login</span>
                </button>
            </form>
            <div class="mt-4 text-center">
                <button id="auth-switch" class="text-purple-400 hover:text-purple-300">
                    Don't have an account? Register
                </button>
            </div>
        </div>
    </div>

    <!-- Rating Modal -->
    <div id="rating-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-gray-800 p-6 rounded-lg max-w-sm w-full mx-4">
            <h3 class="text-xl font-bold mb-4">Rate Content</h3>
            <div class="mb-4">
                <div class="flex justify-center space-x-1 mb-2">
                    <div id="star-rating" class="flex">
                        <i class="fas fa-star text-2xl text-gray-400 cursor-pointer" data-rating="1"></i>
                        <i class="fas fa-star text-2xl text-gray-400 cursor-pointer" data-rating="2"></i>
                        <i class="fas fa-star text-2xl text-gray-400 cursor-pointer" data-rating="3"></i>
                        <i class="fas fa-star text-2xl text-gray-400 cursor-pointer" data-rating="4"></i>
                        <i class="fas fa-star text-2xl text-gray-400 cursor-pointer" data-rating="5"></i>
                    </div>
                </div>
                <p class="text-center text-sm text-gray-400">Click to rate (1-5 stars)</p>
            </div>
            <div class="flex space-x-4">
                <button id="cancel-rating" class="flex-1 bg-gray-600 hover:bg-gray-700 py-2 rounded-lg">Cancel</button>
                <button id="submit-rating" class="flex-1 bg-purple-600 hover:bg-purple-700 py-2 rounded-lg">Submit</button>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loading-spinner" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-gray-800 p-6 rounded-lg">
            <i class="fas fa-spinner loading text-3xl text-purple-400"></i>
            <p class="mt-2 text-center">Loading...</p>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE_URL = 'https://movies-rec-1hcv.onrender.com';
        const TMDB_IMAGE_BASE = 'https://image.tmdb.org/t/p/w500';

        // State Management
        let currentUser = null;
        let currentContentId = null;
        let currentRating = 0;

        // Utility Functions
        const api = {
            get: async (endpoint) => {
                const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                    credentials: 'include',
                    headers: { 'Content-Type': 'application/json' }
                });
                return response.json();
            },
            
            post: async (endpoint, data) => {
                const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                    method: 'POST',
                    credentials: 'include',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                return response.json();
            },
            
            delete: async (endpoint) => {
                const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                    method: 'DELETE',
                    credentials: 'include'
                });
                return response.json();
            }
        };

        const ui = {
            showLoading: () => document.getElementById('loading-spinner').classList.remove('hidden'),
            hideLoading: () => document.getElementById('loading-spinner').classList.add('hidden'),
            
            showPage: (pageId) => {
                document.querySelectorAll('.page').forEach(page => page.classList.add('hidden'));
                document.getElementById(pageId).classList.remove('hidden');
                document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('text-purple-400'));
                document.querySelector(`[data-page="${pageId.replace('-page', '')}"]`)?.classList.add('text-purple-400');
            },
            
            showModal: (modalId) => document.getElementById(modalId).classList.remove('hidden'),
            hideModal: (modalId) => document.getElementById(modalId).classList.add('hidden'),
            
            toast: (message, type = 'info') => {
                const toast = document.createElement('div');
                toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white z-50 ${
                    type === 'success' ? 'bg-green-600' : 
                    type === 'error' ? 'bg-red-600' : 'bg-blue-600'
                }`;
                toast.textContent = message;
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            }
        };

        // Content Rendering
        const renderContent = (items, containerId) => {
            const container = document.getElementById(containerId);
            const template = document.getElementById('content-card-template');
            
            container.innerHTML = '';
            items.forEach(item => {
                const card = template.content.cloneNode(true);
                const img = card.querySelector('img');
                const title = card.querySelector('.content-title');
                const overview = card.querySelector('.content-overview');
                const rating = card.querySelector('.rating-value');
                const releaseDate = card.querySelector('.release-date');
                const contentType = card.querySelector('.content-type');
                const watchlistBtn = card.querySelector('.watchlist-btn');
                const rateBtn = card.querySelector('.rate-btn');
                
                // Set content data
                img.src = item.poster_path ? `${TMDB_IMAGE_BASE}${item.poster_path}` : 
                         item.images?.jpg?.large_image_url || 'https://via.placeholder.com/300x450?text=No+Image';
                img.alt = item.title || item.name;
                title.textContent = item.title || item.name;
                overview.textContent = (item.overview || item.synopsis || '').substring(0, 100) + '...';
                rating.textContent = (item.vote_average || item.score || 0).toFixed(1);
                releaseDate.textContent = item.release_date || item.first_air_date || item.aired?.from || 'N/A';
                contentType.textContent = item.content_type || 'movie';
                
                // Event listeners
                watchlistBtn.onclick = () => toggleWatchlist(item.id);
                rateBtn.onclick = () => openRatingModal(item.id);
                
                container.appendChild(card);
            });
        };

        // Authentication
        const auth = {
            login: async (username, password) => {
                const result = await api.post('/auth/login', { username, password });
                if (result.user) {
                    currentUser = result.user;
                    updateAuthUI();
                    ui.toast('Login successful!', 'success');
                    return true;
                }
                ui.toast(result.error || 'Login failed', 'error');
                return false;
            },
            
            register: async (username, email, password) => {
                const result = await api.post('/auth/register', { username, email, password });
                if (result.message) {
                    ui.toast('Registration successful! Please login.', 'success');
                    return true;
                }
                ui.toast(result.error || 'Registration failed', 'error');
                return false;
            },
            
            logout: async () => {
                await api.post('/auth/logout');
                currentUser = null;
                updateAuthUI();
                ui.toast('Logged out successfully', 'success');
            }
        };

        const updateAuthUI = () => {
            const authButtons = document.getElementById('auth-buttons');
            const userMenu = document.getElementById('user-menu');
            const username = document.getElementById('username');
            
            if (currentUser) {
                authButtons.classList.add('hidden');
                userMenu.classList.remove('hidden');
                username.textContent = currentUser.username;
            } else {
                authButtons.classList.remove('hidden');
                userMenu.classList.add('hidden');
            }
        };

        // Content Actions
        const toggleWatchlist = async (contentId) => {
            if (!currentUser) {
                ui.toast('Please login to use watchlist', 'error');
                return;
            }
            
            const result = await api.post('/watchlist', { content_id: contentId });
            ui.toast(result.message || 'Watchlist updated', 'success');
        };

        const openRatingModal = (contentId) => {
            if (!currentUser) {
                ui.toast('Please login to rate content', 'error');
                return;
            }
            
            currentContentId = contentId;
            currentRating = 0;
            updateStarRating();
            ui.showModal('rating-modal');
        };

        const updateStarRating = () => {
            document.querySelectorAll('#star-rating i').forEach((star, index) => {
                star.className = `fas fa-star text-2xl cursor-pointer ${
                    index < currentRating ? 'text-yellow-400' : 'text-gray-400'
                }`;
            });
        };

        const submitRating = async () => {
            if (currentRating === 0) {
                ui.toast('Please select a rating', 'error');
                return;
            }
            
            const result = await api.post('/rate', {
                content_id: currentContentId,
                rating: currentRating * 2 // Convert 1-5 to 1-10
            });
            
            ui.toast(result.message || 'Rating submitted', 'success');
            ui.hideModal('rating-modal');
        };

        // Data Loading
        const loadContent = {
            featured: async () => {
                const data = await api.get('/featured');
                renderContent(data.featured || [], 'featured-content');
            },
            
            recommendations: async () => {
                if (!currentUser) return;
                const data = await api.get('/recommendations');
                renderContent(data.recommendations || [], 'recommendations-content');
            },
            
            trending: async (type = 'all') => {
                const data = await api.get(`/trending?type=${type}`);
                const items = [...(data.movies || []), ...(data.tv || []), ...(data.anime || [])];
                renderContent(items, 'trending-content');
            },
            
            search: async (query, type = 'all') => {
                const data = await api.get(`/search?q=${encodeURIComponent(query)}&type=${type}`);
                const items = [...(data.movies || []), ...(data.tv || []), ...(data.anime || [])];
                renderContent(items, 'search-results');
            },
            
            watchlist: async () => {
                if (!currentUser) return;
                const data = await api.get('/watchlist');
                renderContent(data.watchlist || [], 'watchlist-content');
            }
        };

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = e.target.dataset.page;
                    ui.showPage(`${page}-page`);
                    
                    // Load page-specific content
                    if (page === 'trending') loadContent.trending();
                    else if (page === 'watchlist') loadContent.watchlist();
                });
            });
            
            // Auth buttons
            document.getElementById('login-btn').onclick = () => {
                document.getElementById('auth-title').textContent = 'Login';
                document.getElementById('auth-submit-text').textContent = 'Login';
                document.getElementById('auth-switch').textContent = "Don't have an account? Register";
                document.getElementById('email-field').classList.add('hidden');
                ui.showModal('auth-modal');
            };
            
            document.getElementById('register-btn').onclick = () => {
                document.getElementById('auth-title').textContent = 'Register';
                document.getElementById('auth-submit-text').textContent = 'Register';
                document.getElementById('auth-switch').textContent = "Already have an account? Login";
                document.getElementById('email-field').classList.remove('hidden');
                ui.showModal('auth-modal');
            };
            
            document.getElementById('logout-btn').onclick = auth.logout;
            
            // Modal controls
            document.getElementById('close-modal').onclick = () => ui.hideModal('auth-modal');
            document.getElementById('cancel-rating').onclick = () => ui.hideModal('rating-modal');
            document.getElementById('submit-rating').onclick = submitRating;
            
            // Auth form
            document.getElementById('auth-form').onsubmit = async (e) => {
                e.preventDefault();
                const username = document.getElementById('auth-username').value;
                const email = document.getElementById('auth-email').value;
                const password = document.getElementById('auth-password').value;
                const isLogin = document.getElementById('auth-title').textContent === 'Login';
                
                ui.showLoading();
                const success = isLogin ? 
                    await auth.login(username, password) :
                    await auth.register(username, email, password);
                ui.hideLoading();
                
                if (success) {
                    ui.hideModal('auth-modal');
                    if (isLogin) {
                        loadContent.recommendations();
                    }
                }
            };
            
            // Auth switch
            document.getElementById('auth-switch').onclick = () => {
                const isLogin = document.getElementById('auth-title').textContent === 'Login';
                if (isLogin) {
                    document.getElementById('auth-title').textContent = 'Register';
                    document.getElementById('auth-submit-text').textContent = 'Register';
                    document.getElementById('auth-switch').textContent = "Already have an account? Login";
                    document.getElementById('email-field').classList.remove('hidden');
                } else {
                    document.getElementById('auth-title').textContent = 'Login';
                    document.getElementById('auth-submit-text').textContent = 'Login';
                    document.getElementById('auth-switch').textContent = "Don't have an account? Register";
                    document.getElementById('email-field').classList.add('hidden');
                }
            };
            
            // Search
            document.getElementById('search-btn').onclick = () => {
                const query = document.getElementById('search-input').value;
                const type = document.getElementById('search-type').value;
                if (query.trim()) {
                    loadContent.search(query, type);
                }
            };
            
            document.getElementById('search-input').onkeypress = (e) => {
                if (e.key === 'Enter') {
                    document.getElementById('search-btn').click();
                }
            };
            
            // Trending filters
            document.querySelectorAll('.trending-filter').forEach(filter => {
                filter.onclick = () => {
                    document.querySelectorAll('.trending-filter').forEach(f => {
                        f.classList.remove('active', 'bg-purple-600');
                        f.classList.add('bg-gray-600');
                    });
                    filter.classList.add('active', 'bg-purple-600');
                    filter.classList.remove('bg-gray-600');
                    loadContent.trending(filter.dataset.type);
                };
            });
            
            // Star rating
            document.querySelectorAll('#star-rating i').forEach((star, index) => {
                star.onclick = () => {
                    currentRating = index + 1;
                    updateStarRating();
                };
            });
            
            // Initial load
            loadContent.featured();
            loadContent.trending();
        });
    </script>
</body>
</html>