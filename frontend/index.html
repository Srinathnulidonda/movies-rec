<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Recommendations</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/bootstrap.min.css" rel="stylesheet">
    <style>body{font-family:Arial;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;margin:0}.movie-card{background:rgba(255,255,255,0.1);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.2);border-radius:15px;transition:all 0.3s ease;cursor:pointer}.movie-card:hover{transform:translateY(-5px);box-shadow:0 20px 40px rgba(0,0,0,0.3)}.movie-poster{width:100%;height:300px;object-fit:cover;border-radius:10px}.search-box{background:rgba(255,255,255,0.2);border:none;border-radius:25px;padding:12px 20px;color:white}.search-box::placeholder{color:rgba(255,255,255,0.7)}.btn-custom{background:linear-gradient(45deg,#ff6b6b,#4ecdc4);border:none;border-radius:25px;padding:10px 25px;color:white;font-weight:bold;transition:all 0.3s ease}.btn-custom:hover{transform:scale(1.05);box-shadow:0 10px 20px rgba(0,0,0,0.2)}.modal-custom{background:rgba(0,0,0,0.9);backdrop-filter:blur(5px)}.auth-modal{background:rgba(255,255,255,0.95);border-radius:15px}</style>
</head>
<body>
    <nav class="navbar navbar-expand-lg" style="background:rgba(0,0,0,0.1);">
        <div class="container">
            <a class="navbar-brand text-white fw-bold fs-3">üé¨ CineRec</a>
            <div class="d-flex gap-3">
                <button class="btn btn-outline-light" onclick="showAuth('login')">Login</button>
                <button class="btn btn-outline-light" onclick="showAuth('register')">Register</button>
                <button class="btn btn-outline-light" onclick="showWishlist()">Wishlist</button>
                <button class="btn btn-outline-light" onclick="showFavorites()">Favorites</button>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        <div class="text-center mb-5">
            <h1 class="text-white display-4 fw-bold mb-4">Discover Your Next Favorite</h1>
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <input type="text" id="searchInput" class="form-control search-box" placeholder="Search movies, anime, series...">
                </div>
                <div class="col-auto">
                    <button class="btn btn-custom" onclick="searchMovies()">Search</button>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-12 text-center">
                <button class="btn btn-custom me-2" onclick="getRecommendations()">Get Recommendations</button>
                <button class="btn btn-custom me-2" onclick="loadMovies('popular')">Popular</button>
                <button class="btn btn-custom me-2" onclick="loadMovies('trending')">Trending</button>
                <button class="btn btn-custom" onclick="loadMovies('anime')">Anime</button>
            </div>
        </div>

        <div id="moviesContainer" class="row g-4"></div>
    </div>

    <!-- Movie Details Modal -->
    <div class="modal fade" id="movieModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content modal-custom">
                <div class="modal-header border-0">
                    <h5 class="modal-title text-white" id="movieTitle"></h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="movieDetails"></div>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div class="modal fade" id="authModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content auth-modal">
                <div class="modal-header border-0">
                    <h5 class="modal-title" id="authTitle">Login</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="authForm">
                        <div class="mb-3">
                            <input type="email" class="form-control" id="email" placeholder="Email" required>
                        </div>
                        <div class="mb-3">
                            <input type="password" class="form-control" id="password" placeholder="Password" required>
                        </div>
                        <button type="submit" class="btn btn-custom w-100">Submit</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE = 'https://your-backend-url.onrender.com'; // Replace with your Render URL
        let currentUser = null;

        // Auth Functions
        function showAuth(type) {
            document.getElementById('authTitle').textContent = type === 'login' ? 'Login' : 'Register';
            document.getElementById('authForm').onsubmit = type === 'login' ? handleLogin : handleRegister;
            new bootstrap.Modal(document.getElementById('authModal')).show();
        }

        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            try {
                const response = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({email, password})
                });
                const data = await response.json();
                if (data.success) {
                    currentUser = data.user;
                    bootstrap.Modal.getInstance(document.getElementById('authModal')).hide();
                    alert('Login successful!');
                } else alert('Login failed');
            } catch (error) {
                console.error('Login error:', error);
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            try {
                const response = await fetch(`${API_BASE}/register`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({email, password})
                });
                const data = await response.json();
                if (data.success) {
                    bootstrap.Modal.getInstance(document.getElementById('authModal')).hide();
                    alert('Registration successful! Please login.');
                } else alert('Registration failed');
            } catch (error) {
                console.error('Register error:', error);
            }
        }

        // Movie Functions
        async function searchMovies() {
            const query = document.getElementById('searchInput').value;
            if (!query) return;
            try {
                const response = await fetch(`${API_BASE}/search?q=${query}`);
                const data = await response.json();
                displayMovies(data.results);
            } catch (error) {
                console.error('Search error:', error);
            }
        }

        async function loadMovies(type) {
            try {
                const response = await fetch(`${API_BASE}/movies/${type}`);
                const data = await response.json();
                displayMovies(data.results);
            } catch (error) {
                console.error('Load movies error:', error);
            }
        }

        async function getRecommendations() {
            if (!currentUser) {
                alert('Please login to get personalized recommendations');
                return;
            }
            try {
                const response = await fetch(`${API_BASE}/recommendations/${currentUser.id}`);
                const data = await response.json();
                displayMovies(data.results);
            } catch (error) {
                console.error('Recommendations error:', error);
            }
        }

        function displayMovies(movies) {
            const container = document.getElementById('moviesContainer');
            container.innerHTML = movies.map(movie => `
                <div class="col-md-3 mb-4">
                    <div class="movie-card p-3 h-100" onclick="showMovieDetails(${movie.id})">
                        <img src="https://image.tmdb.org/t/p/w500${movie.poster_path}" alt="${movie.title}" class="movie-poster mb-3">
                        <h6 class="text-white fw-bold">${movie.title || movie.name}</h6>
                        <p class="text-light small">${movie.release_date?.split('-')[0] || movie.first_air_date?.split('-')[0]}</p>
                        <div class="d-flex justify-content-between">
                            <span class="text-warning">‚≠ê ${movie.vote_average.toFixed(1)}</span>
                            <div>
                                <button class="btn btn-sm btn-outline-light me-1" onclick="event.stopPropagation(); addToWishlist(${movie.id})">üíù</button>
                                <button class="btn btn-sm btn-outline-light" onclick="event.stopPropagation(); addToFavorites(${movie.id})">‚ù§Ô∏è</button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function showMovieDetails(movieId) {
            try {
                const response = await fetch(`${API_BASE}/movie/${movieId}`);
                const movie = await response.json();
                
                document.getElementById('movieTitle').textContent = movie.title || movie.name;
                document.getElementById('movieDetails').innerHTML = `
                    <div class="row">
                        <div class="col-md-4">
                            <img src="https://image.tmdb.org/t/p/w500${movie.poster_path}" class="img-fluid rounded">
                        </div>
                        <div class="col-md-8 text-white">
                            <h5>${movie.title || movie.name}</h5>
                            <p><strong>Rating:</strong> ${movie.vote_average}/10</p>
                            <p><strong>Release:</strong> ${movie.release_date || movie.first_air_date}</p>
                            <p><strong>Runtime:</strong> ${movie.runtime || movie.episode_run_time?.[0] || 'N/A'} minutes</p>
                            <p><strong>Genres:</strong> ${movie.genres?.map(g => g.name).join(', ')}</p>
                            <p><strong>Overview:</strong> ${movie.overview}</p>
                            <div class="mt-3">
                                <h6>Watch On:</h6>
                                <div id="watchProviders">Loading providers...</div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Load watch providers
                loadWatchProviders(movieId);
                new bootstrap.Modal(document.getElementById('movieModal')).show();
            } catch (error) {
                console.error('Movie details error:', error);
            }
        }

        async function loadWatchProviders(movieId) {
            try {
                const response = await fetch(`${API_BASE}/watch-providers/${movieId}`);
                const data = await response.json();
                const providers = data.results?.US || {};
                
                let html = '';
                if (providers.flatrate) {
                    html += '<p><strong>Streaming:</strong> ' + providers.flatrate.map(p => `<span class="badge bg-primary me-1">${p.provider_name}</span>`).join('') + '</p>';
                }
                if (providers.rent) {
                    html += '<p><strong>Rent:</strong> ' + providers.rent.map(p => `<span class="badge bg-warning me-1">${p.provider_name}</span>`).join('') + '</p>';
                }
                if (providers.buy) {
                    html += '<p><strong>Buy:</strong> ' + providers.buy.map(p => `<span class="badge bg-success me-1">${p.provider_name}</span>`).join('') + '</p>';
                }
                
                document.getElementById('watchProviders').innerHTML = html || 'No providers available';
            } catch (error) {
                document.getElementById('watchProviders').innerHTML = 'Error loading providers';
            }
        }

        async function addToWishlist(movieId) {
            if (!currentUser) {
                alert('Please login first');
                return;
            }
            try {
                await fetch(`${API_BASE}/wishlist/${currentUser.id}/${movieId}`, {method: 'POST'});
                alert('Added to wishlist!');
            } catch (error) {
                console.error('Wishlist error:', error);
            }
        }

        async function addToFavorites(movieId) {
            if (!currentUser) {
                alert('Please login first');
                return;
            }
            try {
                await fetch(`${API_BASE}/favorites/${currentUser.id}/${movieId}`, {method: 'POST'});
                alert('Added to favorites!');
            } catch (error) {
                console.error('Favorites error:', error);
            }
        }

        async function showWishlist() {
            if (!currentUser) {
                alert('Please login first');
                return;
            }
            try {
                const response = await fetch(`${API_BASE}/wishlist/${currentUser.id}`);
                const data = await response.json();
                displayMovies(data.results);
            } catch (error) {
                console.error('Wishlist error:', error);
            }
        }

        async function showFavorites() {
            if (!currentUser) {
                alert('Please login first');
                return;
            }
            try {
                const response = await fetch(`${API_BASE}/favorites/${currentUser.id}`);
                const data = await response.json();
                displayMovies(data.results);
            } catch (error) {
                console.error('Favorites error:', error);
            }
        }

        // Load popular movies on page load
        window.onload = () => loadMovies('popular');
    </script>
</body>
</html>