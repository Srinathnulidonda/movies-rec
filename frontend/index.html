<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŽ¬ CineFlow - Movie Recommendations</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>body{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;font-family:'Inter',sans-serif}.card{backdrop-filter:blur(10px);background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);transition:all 0.3s ease}.card:hover{transform:translateY(-5px);box-shadow:0 20px 40px rgba(0,0,0,0.1)}.movie-card{position:relative;overflow:hidden;border-radius:15px;cursor:pointer}.movie-card img{transition:transform 0.3s ease}.movie-card:hover img{transform:scale(1.1)}.search-box{background:rgba(255,255,255,0.2);border:none;backdrop-filter:blur(10px)}.btn-primary{background:linear-gradient(45deg,#ff6b6b,#ee5a52);border:none}.btn-primary:hover{background:linear-gradient(45deg,#ee5a52,#ff6b6b)}.navbar{background:rgba(255,255,255,0.1);backdrop-filter:blur(10px)}.loading{display:none}.genre-tag{background:rgba(255,255,255,0.2);backdrop-filter:blur(5px)}</style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold fs-3" href="#">ðŸŽ¬ CineFlow</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="#" onclick="showPage('home')">Home</a>
                <a class="nav-link" href="#" onclick="showPage('recommendations')">Recommendations</a>
                <a class="nav-link" href="#" onclick="showPage('wishlist')">Wishlist</a>
                <a class="nav-link" href="#" onclick="showPage('favorites')">Favorites</a>
                <a class="nav-link" href="#" onclick="showPage('admin')">Admin</a>
                <button class="btn btn-outline-light btn-sm ms-2" onclick="toggleAuth()">Login</button>
            </div>
        </div>
    </nav>

    <div id="home-page" class="container mt-4">
        <div class="text-center mb-5">
            <h1 class="display-4 fw-bold text-white mb-3">Discover Your Next Favorite</h1>
            <p class="lead text-white-50">Movies, Anime & Series personalized just for you</p>
        </div>

        <div class="row justify-content-center mb-5">
            <div class="col-md-8">
                <div class="input-group input-group-lg">
                    <input type="text" id="searchInput" class="form-control search-box text-white" placeholder="Search movies, anime, or series..." style="color: white !important;">
                    <button class="btn btn-primary" onclick="searchContent()">
                        <i class="fas fa-search"></i> Search
                    </button>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex flex-wrap gap-2 justify-content-center">
                    <button class="btn btn-sm genre-tag text-white" onclick="filterByGenre('action')">Action</button>
                    <button class="btn btn-sm genre-tag text-white" onclick="filterByGenre('comedy')">Comedy</button>
                    <button class="btn btn-sm genre-tag text-white" onclick="filterByGenre('drama')">Drama</button>
                    <button class="btn btn-sm genre-tag text-white" onclick="filterByGenre('horror')">Horror</button>
                    <button class="btn btn-sm genre-tag text-white" onclick="filterByGenre('anime')">Anime</button>
                    <button class="btn btn-sm genre-tag text-white" onclick="filterByGenre('series')">Series</button>
                </div>
            </div>
        </div>

        <div class="loading text-center">
            <div class="spinner-border text-light" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>

        <div id="content-grid" class="row g-4">
            <!-- Content will be loaded here -->
        </div>
    </div>

    <div id="other-pages" style="display: none;">
        <div class="container mt-4">
            <div id="page-content" class="text-white">
                <!-- Dynamic content -->
            </div>
        </div>
    </div>

    <!-- Movie Detail Modal -->
    <div class="modal fade" id="movieModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="background: rgba(0,0,0,0.9); color: white;">
                <div class="modal-header border-0">
                    <h5 class="modal-title" id="movieTitle"></h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="movieDetails">
                    <!-- Movie details will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE = 'https://movies-rec-1hcv.onrender.com';
        let currentUser = null;
        let currentPage = 'home';

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadFeaturedContent();
        });

        // API calls
        async function apiCall(endpoint, options = {}) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': currentUser ? `Bearer ${currentUser.token}` : '',
                        ...options.headers
                    },
                    ...options
                });
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                return { error: 'Network error' };
            }
        }

        // Load featured content
        async function loadFeaturedContent() {
            document.querySelector('.loading').style.display = 'block';
            const data = await apiCall('/api/featured');
            document.querySelector('.loading').style.display = 'none';
            
            if (data.results) {
                displayContent(data.results);
            }
        }

        // Search functionality
        async function searchContent() {
            const query = document.getElementById('searchInput').value;
            if (!query) return;
            
            document.querySelector('.loading').style.display = 'block';
            const data = await apiCall(`/api/search?q=${encodeURIComponent(query)}`);
            document.querySelector('.loading').style.display = 'none';
            
            if (data.results) {
                displayContent(data.results);
            }
        }

        // Filter by genre
        async function filterByGenre(genre) {
            document.querySelector('.loading').style.display = 'block';
            const data = await apiCall(`/api/filter?genre=${genre}`);
            document.querySelector('.loading').style.display = 'none';
            
            if (data.results) {
                displayContent(data.results);
            }
        }

        // Display content
        function displayContent(items) {
            const grid = document.getElementById('content-grid');
            grid.innerHTML = items.map(item => `
                <div class="col-md-3 col-sm-6">
                    <div class="card movie-card h-100" onclick="showMovieDetails(${item.id}, '${item.type}')">
                        <img src="${item.poster}" class="card-img-top" alt="${item.title}" style="height: 400px; object-fit: cover;">
                        <div class="card-body">
                            <h6 class="card-title text-white">${item.title}</h6>
                            <p class="card-text text-white-50 small">${item.year} â€¢ ${item.rating}/10</p>
                            <div class="d-flex justify-content-between">
                                <button class="btn btn-sm btn-outline-light" onclick="event.stopPropagation(); addToWishlist(${item.id})">
                                    <i class="fas fa-heart"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-light" onclick="event.stopPropagation(); addToFavorites(${item.id})">
                                    <i class="fas fa-star"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Show movie details
        async function showMovieDetails(id, type) {
            const data = await apiCall(`/api/details/${id}?type=${type}`);
            if (data.error) return;
            
            document.getElementById('movieTitle').textContent = data.title;
            document.getElementById('movieDetails').innerHTML = `
                <div class="row">
                    <div class="col-md-4">
                        <img src="${data.poster}" class="img-fluid rounded" alt="${data.title}">
                    </div>
                    <div class="col-md-8">
                        <h6>Overview</h6>
                        <p>${data.overview}</p>
                        <p><strong>Genre:</strong> ${data.genres.join(', ')}</p>
                        <p><strong>Release Date:</strong> ${data.release_date}</p>
                        <p><strong>Rating:</strong> ${data.rating}/10</p>
                        <p><strong>Runtime:</strong> ${data.runtime} min</p>
                        
                        <h6 class="mt-3">Watch On</h6>
                        <div class="d-flex flex-wrap gap-2">
                            ${data.watch_providers.map(provider => `
                                <a href="${provider.link}" target="_blank" class="btn btn-sm btn-primary">
                                    ${provider.name}
                                </a>
                            `).join('')}
                        </div>
                        
                        <div class="mt-3">
                            <button class="btn btn-success me-2" onclick="addToWishlist(${id})">Add to Wishlist</button>
                            <button class="btn btn-warning" onclick="addToFavorites(${id})">Add to Favorites</button>
                        </div>
                    </div>
                </div>
            `;
            
            new bootstrap.Modal(document.getElementById('movieModal')).show();
        }

        // User actions
        async function addToWishlist(id) {
            if (!currentUser) {
                alert('Please login first');
                return;
            }
            await apiCall('/api/wishlist', {
                method: 'POST',
                body: JSON.stringify({ movie_id: id })
            });
        }

        async function addToFavorites(id) {
            if (!currentUser) {
                alert('Please login first');
                return;
            }
            await apiCall('/api/favorites', {
                method: 'POST',
                body: JSON.stringify({ movie_id: id })
            });
        }

        // Navigation
        function showPage(page) {
            currentPage = page;
            if (page === 'home') {
                document.getElementById('home-page').style.display = 'block';
                document.getElementById('other-pages').style.display = 'none';
            } else {
                document.getElementById('home-page').style.display = 'none';
                document.getElementById('other-pages').style.display = 'block';
                loadPageContent(page);
            }
        }

        async function loadPageContent(page) {
            const content = document.getElementById('page-content');
            
            switch(page) {
                case 'recommendations':
                    const recs = await apiCall('/api/recommendations');
                    content.innerHTML = `
                        <h2>Personalized Recommendations</h2>
                        <div class="row g-4">
                            ${recs.results ? recs.results.map(item => `
                                <div class="col-md-3">
                                    <div class="card movie-card" onclick="showMovieDetails(${item.id}, '${item.type}')">
                                        <img src="${item.poster}" class="card-img-top" alt="${item.title}">
                                        <div class="card-body">
                                            <h6 class="card-title">${item.title}</h6>
                                            <p class="card-text small">${item.year} â€¢ ${item.rating}/10</p>
                                        </div>
                                    </div>
                                </div>
                            `).join('') : '<p>Please login to see recommendations</p>'}
                        </div>
                    `;
                    break;
                case 'wishlist':
                    const wishlist = await apiCall('/api/wishlist');
                    content.innerHTML = `<h2>My Wishlist</h2><div class="row g-4">${wishlist.results ? wishlist.results.map(item => `<div class="col-md-3"><div class="card movie-card"><img src="${item.poster}" class="card-img-top" alt="${item.title}"><div class="card-body"><h6 class="card-title">${item.title}</h6></div></div></div>`).join('') : '<p>Your wishlist is empty</p>'}</div>`;
                    break;
                case 'favorites':
                    const favorites = await apiCall('/api/favorites');
                    content.innerHTML = `<h2>My Favorites</h2><div class="row g-4">${favorites.results ? favorites.results.map(item => `<div class="col-md-3"><div class="card movie-card"><img src="${item.poster}" class="card-img-top" alt="${item.title}"><div class="card-body"><h6 class="card-title">${item.title}</h6></div></div></div>`).join('') : '<p>No favorites yet</p>'}</div>`;
                    break;
                case 'admin':
                    content.innerHTML = `
                        <h2>Admin Panel</h2>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body">
                                        <h5>Post Featured Content</h5>
                                        <form onsubmit="postFeatured(event)">
                                            <input type="text" class="form-control mb-2" placeholder="Movie/Series ID" id="featuredId">
                                            <textarea class="form-control mb-2" placeholder="Description" id="featuredDesc"></textarea>
                                            <button type="submit" class="btn btn-primary">Post to Website</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body">
                                        <h5>Post to Telegram</h5>
                                        <form onsubmit="postToTelegram(event)">
                                            <textarea class="form-control mb-2" placeholder="Message" id="telegramMsg"></textarea>
                                            <button type="submit" class="btn btn-success">Send to Telegram</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
            }
        }

        // Admin functions
        async function postFeatured(event) {
            event.preventDefault();
            const id = document.getElementById('featuredId').value;
            const desc = document.getElementById('featuredDesc').value;
            await apiCall('/api/admin/featured', {
                method: 'POST',
                body: JSON.stringify({ movie_id: id, description: desc })
            });
        }

        async function postToTelegram(event) {
            event.preventDefault();
            const msg = document.getElementById('telegramMsg').value;
            await apiCall('/api/admin/telegram', {
                method: 'POST',
                body: JSON.stringify({ message: msg })
            });
        }

        // Auth
        function toggleAuth() {
            if (currentUser) {
                currentUser = null;
                document.querySelector('.navbar button').textContent = 'Login';
            } else {
                // Simple mock login
                currentUser = { token: 'mock-token', id: 1 };
                document.querySelector('.navbar button').textContent = 'Logout';
            }
        }

        // Search on Enter
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchContent();
            }
        });
    </script>
</body>
</html>